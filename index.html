<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘„åƒå¤´å›¾åƒæ•è·ä¸GitHubä¸Šä¼ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .camera-section, .github-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 0.5rem;
        }
        
        .video-container {
            width: 100%;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            aspect-ratio: 4/3;
        }
        
        #video {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }
        
        .placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #222;
            color: #aaa;
            border-radius: 10px;
        }
        
        .placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 50px;
            background: #4CAF50;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: #ff9800;
        }
        
        button.danger {
            background: #f44336;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .captured-image {
            width: 100%;
            margin-top: 1rem;
        }
        
        #canvas {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: none;
        }
        
        .github-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        label {
            font-weight: 600;
        }
        
        input, textarea {
            padding: 0.8rem;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .status {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .success {
            color: #4CAF50;
        }
        
        .error {
            color: #f44336;
        }
        
        footer {
            margin-top: 2rem;
            text-align: center;
            opacity: 0.7;
            font-size: 0.9rem;
            max-width: 800px;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .info-box h3 {
            margin-bottom: 0.5rem;
        }
        
        .info-box ul {
            padding-left: 1.5rem;
        }
        
        .info-box li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ‘„åƒå¤´å›¾åƒæ•è·ä¸GitHubä¸Šä¼ </h1>
            <p class="subtitle">æ‹æ‘„ç…§ç‰‡å¹¶ä¸Šä¼ åˆ°GitHubä»“åº“: Hshsbsbdbbsbbs/nnoonn1994.github.io</p>
        </header>
        
        <div class="content">
            <section class="camera-section">
                <h2 class="section-title">æ‘„åƒå¤´æ§åˆ¶</h2>
                
                <div class="video-container">
                    <div class="placeholder" id="placeholder">
                        <i>ğŸ“·</i>
                        <p>ç‚¹å‡»"å¼€å¯æ‘„åƒå¤´"å¼€å§‹ä½¿ç”¨</p>
                    </div>
                    <video id="video" autoplay playsinline class="hidden"></video>
                </div>
                
                <div class="controls">
                    <button id="startButton">
                        <span>å¼€å¯æ‘„åƒå¤´</span>
                    </button>
                    <button id="captureButton" disabled>
                        <span>æ‹æ‘„ç…§ç‰‡</span>
                    </button>
                    <button id="stopButton" class="danger" disabled>
                        <span>å…³é—­æ‘„åƒå¤´</span>
                    </button>
                </div>
                
                <div class="captured-image">
                    <canvas id="canvas"></canvas>
                </div>
            </section>
            
            <section class="github-section">
                <h2 class="section-title">GitHubä¸Šä¼ </h2>
                
                <div class="github-form">
                    <div class="form-group">
                        <label for="repoOwner">ä»“åº“æ‰€æœ‰è€…</label>
                        <input type="text" id="repoOwner" value="Hshsbsbdbbsbbs" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="repoName">ä»“åº“åç§°</label>
                        <input type="text" id="repoName" value="nnoonn1994.github.io" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="fileName">æ–‡ä»¶åç§°</label>
                        <input type="text" id="fileName" value="camera-capture" placeholder="è¾“å…¥æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰">
                    </div>
                    
                    <div class="form-group">
                        <label for="commitMessage">æäº¤ä¿¡æ¯</label>
                        <textarea id="commitMessage" placeholder="è¾“å…¥æäº¤ä¿¡æ¯">æ·»åŠ æ‘„åƒå¤´æ‹æ‘„çš„å›¾åƒ</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="githubToken">GitHub Token</label>
                        <input type="password" id="githubToken" placeholder="è¾“å…¥GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ">
                    </div>
                    
                    <button id="uploadButton" class="secondary" disabled>
                        <span>ä¸Šä¼ åˆ°GitHub</span>
                    </button>
                </div>
                
                <div class="status" id="status">
                    ç­‰å¾…ç”¨æˆ·æ“ä½œ...
                </div>
            </section>
        </div>
        
        <div class="info-box">
            <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ul>
                <li>1. ç‚¹å‡»"å¼€å¯æ‘„åƒå¤´"æŒ‰é’®æˆæƒæ‘„åƒå¤´è®¿é—®</li>
                <li>2. è°ƒæ•´å§¿åŠ¿åç‚¹å‡»"æ‹æ‘„ç…§ç‰‡"æŒ‰é’®</li>
                <li>3. è¾“å…¥GitHubä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆéœ€è¦repoæƒé™ï¼‰</li>
                <li>4. ç‚¹å‡»"ä¸Šä¼ åˆ°GitHub"æŒ‰é’®å°†å›¾åƒä¸Šä¼ åˆ°ä»“åº“</li>
                <li>5. å›¾åƒå°†ä¸Šä¼ åˆ°æŒ‡å®šä»“åº“çš„/imagesæ–‡ä»¶å¤¹ä¸­</li>
            </ul>
        </div>
    </div>
    
    <footer>
        <p>æ³¨æ„ï¼šæ­¤åº”ç”¨éœ€è¦GitHubä¸ªäººè®¿é—®ä»¤ç‰Œæ‰èƒ½ä¸Šä¼ æ–‡ä»¶ã€‚æ‚¨å¯ä»¥åœ¨GitHubè®¾ç½®ä¸­ç”Ÿæˆä¸€ä¸ªå…·æœ‰repoæƒé™çš„tokenã€‚</p>
        <p>å›¾åƒå°†ä¸Šä¼ åˆ°: https://github.com/Hshsbsbdbbsbbs/nnoonn1994.github.io/tree/main/images</p>
    </footer>

    <script>
        // è·å–DOMå…ƒç´ 
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const startButton = document.getElementById('startButton');
        const captureButton = document.getElementById('captureButton');
        const uploadButton = document.getElementById('uploadButton');
        const stopButton = document.getElementById('stopButton');
        const statusDiv = document.getElementById('status');
        const placeholder = document.getElementById('placeholder');
        
        const repoOwnerInput = document.getElementById('repoOwner');
        const repoNameInput = document.getElementById('repoName');
        const fileNameInput = document.getElementById('fileName');
        const commitMessageInput = document.getElementById('commitMessage');
        const githubTokenInput = document.getElementById('githubToken');
        
        let stream = null;
        let capturedImageData = null;
        
        // å¼€å¯æ‘„åƒå¤´
        startButton.addEventListener('click', async () => {
            try {
                statusDiv.innerHTML = '<span class="loading"></span> æ­£åœ¨è¯·æ±‚æ‘„åƒå¤´æƒé™...';
                statusDiv.className = 'status';
                
                // è¯·æ±‚æ‘„åƒå¤´è®¿é—®æƒé™
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }, 
                    audio: false 
                });
                
                // å°†è§†é¢‘æµè®¾ç½®ä¸ºvideoå…ƒç´ çš„æº
                video.srcObject = stream;
                
                // æ˜¾ç¤ºè§†é¢‘å…ƒç´ ï¼Œéšè—å ä½ç¬¦
                video.classList.remove('hidden');
                placeholder.classList.add('hidden');
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                startButton.disabled = true;
                captureButton.disabled = false;
                stopButton.disabled = false;
                
                statusDiv.textContent = 'æ‘„åƒå¤´å·²å¼€å¯ï¼Œè¯·ç‚¹å‡»"æ‹æ‘„ç…§ç‰‡"æŒ‰é’®';
            } catch (err) {
                console.error('è®¿é—®æ‘„åƒå¤´æ—¶å‡ºé”™:', err);
                statusDiv.textContent = 'é”™è¯¯: ' + err.message;
                statusDiv.classList.add('error');
            }
        });
        
        // æ‹æ‘„ç…§ç‰‡
        captureButton.addEventListener('click', () => {
            const context = canvas.getContext('2d');
            
            // è®¾ç½®canvaså°ºå¯¸ä¸è§†é¢‘ç›¸åŒ
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // å°†è§†é¢‘å¸§ç»˜åˆ¶åˆ°canvasä¸Š
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // æ˜¾ç¤ºæ‹æ‘„çš„ç…§ç‰‡
            canvas.style.display = 'block';
            
            // è·å–å›¾åƒæ•°æ®
            capturedImageData = canvas.toDataURL('image/jpeg');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            uploadButton.disabled = false;
            
            statusDiv.textContent = 'ç…§ç‰‡å·²æ‹æ‘„ï¼Œå¯ä»¥ä¸Šä¼ åˆ°GitHub';
        });
        
        // ä¸Šä¼ åˆ°GitHub
        uploadButton.addEventListener('click', async () => {
            if (!capturedImageData) {
                statusDiv.textContent = 'é”™è¯¯: è¯·å…ˆæ‹æ‘„ç…§ç‰‡';
                statusDiv.classList.add('error');
                return;
            }
            
            const repoOwner = repoOwnerInput.value;
            const repoName = repoNameInput.value;
            const fileName = fileNameInput.value || 'camera-capture';
            const commitMessage = commitMessageInput.value || 'æ·»åŠ æ‘„åƒå¤´æ‹æ‘„çš„å›¾åƒ';
            const githubToken = githubTokenInput.value;
            
            if (!githubToken) {
                statusDiv.textContent = 'é”™è¯¯: è¯·è¾“å…¥GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ';
                statusDiv.classList.add('error');
                return;
            }
            
            statusDiv.innerHTML = '<span class="loading"></span> æ­£åœ¨ä¸Šä¼ å›¾åƒåˆ°GitHub...';
            statusDiv.className = 'status';
            
            try {
                // å°†DataURLè½¬æ¢ä¸ºBlob
                const response = await fetch(capturedImageData);
                const blob = await response.blob();
                
                // è¯»å–Blobä¸ºbase64
                const base64Data = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        // ç§»é™¤DataURLå‰ç¼€
                        const base64 = reader.result.split(',')[1];
                        resolve(base64);
                    };
                    reader.readAsDataURL(blob);
                });
                
                // GitHub APIè¯·æ±‚
                const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/images/${fileName}-${Date.now()}.jpg`;
                
                const uploadResponse = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: commitMessage,
                        content: base64Data,
                    })
                });
                
                if (uploadResponse.ok) {
                    const result = await uploadResponse.json();
                    statusDiv.innerHTML = `<span class="success">âœ“ å›¾åƒå·²æˆåŠŸä¸Šä¼ åˆ°GitHub!</span>`;
                    statusDiv.classList.add('success');
                    
                    // æ˜¾ç¤ºä¸Šä¼ çš„å›¾åƒé“¾æ¥
                    const imageUrl = result.content.download_url;
                    statusDiv.innerHTML += `<br><a href="${imageUrl}" target="_blank" style="color: #4CAF50; margin-top: 10px; display: inline-block;">æŸ¥çœ‹ä¸Šä¼ çš„å›¾åƒ</a>`;
                    
                    // ç¦ç”¨ä¸Šä¼ æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ä¸Šä¼ 
                    uploadButton.disabled = true;
                } else {
                    const error = await uploadResponse.json();
                    throw new Error(error.message || 'ä¸Šä¼ å¤±è´¥');
                }
            } catch (err) {
                console.error('ä¸Šä¼ åˆ°GitHubæ—¶å‡ºé”™:', err);
                statusDiv.textContent = 'é”™è¯¯: ' + err.message;
                statusDiv.classList.add('error');
            }
        });
        
        // å…³é—­æ‘„åƒå¤´
        stopButton.addEventListener('click', () => {
            if (stream) {
                // åœæ­¢æ‰€æœ‰è§†é¢‘è½¨é“
                stream.getTracks().forEach(track => track.stop());
                
                // é‡ç½®è§†é¢‘å…ƒç´ 
                video.srcObject = null;
                video.classList.add('hidden');
                placeholder.classList.remove('hidden');
                
                // éšè—æ‹æ‘„çš„ç…§ç‰‡
                canvas.style.display = 'none';
                
                // é‡ç½®æŒ‰é’®çŠ¶æ€
                startButton.disabled = false;
                captureButton.disabled = true;
                uploadButton.disabled = true;
                stopButton.disabled = true;
                
                statusDiv.textContent = 'æ‘„åƒå¤´å·²å…³é—­';
                statusDiv.className = 'status';
            }
        });
        
        // å®æ—¶æ›´æ–°ä¸Šä¼ æŒ‰é’®çŠ¶æ€
        githubTokenInput.addEventListener('input', () => {
            if (capturedImageData && githubTokenInput.value) {
                uploadButton.disabled = false;
            } else {
                uploadButton.disabled = true;
            }
        });
    </script>
</body>
</html>