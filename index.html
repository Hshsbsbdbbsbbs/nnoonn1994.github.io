<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TVBOX接口配置编辑器</title>
    <style>
        :root {
            --primary-color: #4a6baf;
            --secondary-color: #5a8dee;
            --accent-color: #ff7043;
            --success-color: #4caf50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            --light-color: #f5f7fa;
            --dark-color: #263238;
            --text-color: #455a64;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f8f9fa;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            touch-action: manipulation;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 15px var(--shadow-color);
            overflow: hidden;
            padding: 25px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            color: var(--primary-color);
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .warning {
            color: var(--danger-color);
            background-color: rgba(244, 67, 54, 0.1);
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 8px;
            background-color: var(--light-color);
            padding: 8px;
            border-radius: 6px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-color);
        }
        
        .tab-btn:hover {
            background-color: rgba(74, 107, 175, 0.1);
            color: var(--primary-color);
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(74, 107, 175, 0.3);
        }
        
        .instruction {
            color: var(--text-color);
            background-color: rgba(90, 141, 238, 0.1);
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 15px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .config-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: none;
        }
        
        .config-section.active {
            display: block;
        }
        
        .config-section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            font-size: 20px;
        }
        
        .config-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .config-label {
            min-width: 120px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            flex: 1;
            min-width: 250px;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(90, 141, 238, 0.2);
        }
        
        textarea {
            min-height: 120px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            line-height: 1.5;
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(74, 107, 175, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .button-edit {
            background-color: var(--info-color);
        }
        
        .button-cancel {
            background-color: var(--danger-color);
        }
        
        .button-success {
            background-color: var(--success-color);
        }
        
        .button-warning {
            background-color: var(--warning-color);
        }
        
        .button-info {
            background-color: var(--info-color);
        }
        
        .source-list {
            margin-top: 25px;
            width: 100%;
        }
        
        .source-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            cursor: move;
            position: relative;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .source-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .source-item.dragging {
            opacity: 0.7;
            border: 2px dashed var(--primary-color);
            background-color: rgba(90, 141, 238, 0.1);
        }
        
        .drag-handle {
            margin-right: 15px;
            cursor: move;
            color: var(--text-color);
            font-size: 18px;
        }
        
        .source-item h4 {
            color: var(--dark-color);
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .source-item p {
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .source-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .category-config {
            margin-top: 20px;
            width: 100%;
        }
        
        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .category-tag {
            background-color: rgba(90, 141, 238, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            font-size: 13px;
            color: var(--primary-color);
        }
        
        .category-tag button {
            margin-left: 8px;
            padding: 2px 6px;
            background-color: var(--danger-color);
            font-size: 12px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            min-width: auto;
        }
        
        .url-list {
            margin-top: 15px;
            width: 100%;
        }
        
        .url-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .url-item input {
            flex: 1;
        }
        
        .url-item button {
            padding: 8px 12px;
            min-width: auto;
        }
        
        .json-output {
            margin-top: 30px;
            width: 100%;
        }
        
        .json-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .json-header h3 {
            color: var(--primary-color);
            font-size: 18px;
        }
        
        .json-header-actions {
            display: flex;
            gap: 10px;
        }
        
        #config-json {
            width: 100%;
            height: 200px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .channel-item,
        .parse-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            cursor: move;
        }
        
        .channel-item.dragging,
        .parse-item.dragging {
            opacity: 0.7;
            border: 2px dashed var(--primary-color);
            background-color: rgba(90, 141, 238, 0.1);
        }
        
        .channel-item p,
        .parse-item p {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .channel-item-actions,
        .parse-item-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 8px;
        }
        
        .ijk-option-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .ijk-option-item select,
        .ijk-option-item input {
            flex: 1;
            min-width: 200px;
        }
        
        .ijk-option-item button {
            padding: 8px 12px;
            min-width: auto;
        }
        
        /* AES加密专用样式 */
        .aes-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .aes-controls button {
            padding: 8px 12px;
        }
        
        #aes-result {
            font-family: 'Consolas', 'Monaco', monospace;
            background-color: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 15px;
            }
            
            .config-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .config-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            input[type="text"],
            input[type="number"],
            select,
            textarea {
                width: 100%;
                min-width: 100%;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
            
            .json-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .json-header-actions {
                width: 100%;
                justify-content: flex-start;
            }
            
            .ijk-option-item select,
            .ijk-option-item input {
                width: 100%;
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TVBOX接口配置编辑器</h1>
            <div class="warning">返回或者关闭浏览器将会丢失记录，谨慎操作！</div>
        </div>

        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="vod">点播源</button>
            <button class="tab-btn" data-tab="live">直播源</button>
            <button class="tab-btn" data-tab="parse">解析地址</button>
            <button class="tab-btn" data-tab="vip">VIP解析标识</button>
            <button class="tab-btn" data-tab="ijk">IJK解码配置</button>
            <button class="tab-btn" data-tab="ad">解析广告过滤</button>
            <button class="tab-btn" data-tab="wallpaper">壁纸</button>
            <button class="tab-btn" data-tab="aes">AES加密</button>
        </div>

        <div class="instruction">
            <i class="icon-info"></i> 配置好后点击"添加点播源"按钮，然后复制到剪贴板即可！
        </div>

        <!-- 原有各配置部分保持不变 -->
        <div class="config-section active" id="vod-config">
            <!-- 点播源配置内容 -->
        </div>

        <div class="source-list" id="vod-list">
            <!-- 点播源列表内容 -->
        </div>

        <div class="config-section" id="live-config">
            <!-- 直播源配置内容 -->
        </div>

        <div class="config-section" id="parse-config">
            <!-- 解析地址配置内容 -->
        </div>

        <div class="config-section" id="vip-config">
            <!-- VIP解析标识内容 -->
        </div>

        <div class="config-section" id="ijk-config">
            <!-- IJK解码配置内容 -->
        </div>

        <div class="config-section" id="ad-config">
            <!-- 广告过滤内容 -->
        </div>

        <div class="config-section" id="wallpaper-config">
            <!-- 壁纸配置内容 -->
        </div>

        <!-- 新增的AES加密配置部分 -->
        <div class="config-section" id="aes-config">
            <h3>AES-128-CBC 加密配置</h3>
            <div class="warning">
                注意：影视仓要求 Key 和 IV 必须为 16 字节（如16个字符或32位Hex）
            </div>
            
            <div class="config-row">
                <div class="config-label">密钥(Key):</div>
                <input type="text" id="aes-key" placeholder="输入16字节密钥" maxlength="16">
                <button id="generate-aes-key" class="button-success">随机生成</button>
            </div>
            
            <div class="config-row">
                <div class="config-label">初始向量(IV):</div>
                <input type="text" id="aes-iv" placeholder="输入16字节IV" maxlength="16">
                <button id="generate-aes-iv" class="button-success">随机生成</button>
            </div>
            
            <div class="config-row">
                <div class="config-label">加密结果:</div>
                <textarea id="aes-result" readonly placeholder="加密后的Base64数据"></textarea>
            </div>
            
            <div class="button-group">
                <button id="encrypt-btn" class="button-success">加密配置</button>
                <button id="copy-aes-btn" class="button-info">复制结果</button>
                <button id="download-aes-btn" class="button-info">下载加密文件</button>
            </div>
        </div>

        <div class="json-output">
            <div class="json-header">
                <h3>生成的配置JSON</h3>
                <div class="json-header-actions">
                    <button id="copy-btn" class="button-success">复制到剪贴板</button>
                    <button id="download-btn" class="button-info">下载配置文件</button>
                </div>
            </div>
            <textarea id="config-json" readonly></textarea>
        </div>
    </div>

    <!-- 引入 CryptoJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化配置数据
            let config = {
                "spider": "",
                "sites": [],
                "lives": [],
                "parses": [],
                "flags": [
                    "youku",
                    "qq",
                    "iqiyi",
                    "qiyi",
                    "letv",
                    "sohu",
                    "tudou",
                    "pptv",
                    "mgtv",
                    "wasu"
                ],
                "categories": ["电影", "电视剧", "动漫", "综艺", "短剧", "纪录片"],
                "ijk": [
                    {
                        "group": "软解码",
                        "options": [
                            {
                                "category": 4,
                                "name": "opensles",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "overlay-format",
                                "value": "842225234"
                            },
                            {
                                "category": 4,
                                "name": "framedrop",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "soundtouch",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "start-on-prepared",
                                "value": "1"
                            },
                            {
                                "category": 1,
                                "name": "http-detect-range-support",
                                "value": "0"
                            },
                            {
                                "category": 1,
                                "name": "fflags",
                                "value": "fastseek"
                            },
                            {
                                "category": 2,
                                "name": "skip_loop_filter",
                                "value": "48"
                            },
                            {
                                "category": 4,
                                "name": "reconnect",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "max-buffer-size",
                                "value": "5242880"
                            },
                            {
                                "category": 4,
                                "name": "enable-accurate-seek",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-auto-rotate",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-handle-resolution-change",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-hevc",
                                "value": "0"
                            }
                        ]
                    },
                    {
                        "group": "硬解码",
                        "options": [
                            {
                                "category": 4,
                                "name": "opensles",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "overlay-format",
                                "value": "842225234"
                            },
                            {
                                "category": 4,
                                "name": "framedrop",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "soundtouch",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "start-on-prepared",
                                "value": "1"
                            },
                            {
                                "category": 1,
                                "name": "http-detect-range-support",
                                "value": "0"
                            },
                            {
                                "category": 1,
                                "name": "fflags",
                                "value": "fastseek"
                            },
                            {
                                "category": 2,
                                "name": "skip_loop_filter",
                                "value": "48"
                            },
                            {
                                "category": 4,
                                "name": "reconnect",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "max-buffer-size",
                                "value": "5242880"
                            },
                            {
                                "category": 4,
                                "name": "enable-accurate-seek",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-auto-rotate",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-handle-resolution-change",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-hevc",
                                "value": "1"
                            }
                        ]
                    }
                ],
                "ads": [
                    "mimg.0c1q0l.cn",
                    "www.googletagmanager.com",
                    "www.google-analytics.com",
                    "mc.usihnbcq.cn",
                    "mg.g1mm3d.cn",
                    "mscs.svaeuzh.cn",
                    "cnzz.hhttm.top",
                    "tp.vinuxhome.com",
                    "cnzz.mmstat.com",
                    "www.baihuillq.com",
                    "s23.cnzz.com",
                    "z3.cnzz.com",
                    "c.cnzz.com",
                    "stj.v1vo.top",
                    "z12.cnzz.com",
                    "img.mosflower.cn",
                    "tips.gamevvip.com",
                    "ehwe.yhdtns.com",
                    "xdn.cqqc3.com",
                    "www.jixunkyy.cn",
                    "sp.chemacid.cn",
                    "hm.baidu.com",
                    "s9.cnzz.com",
                    "z6.cnzz.com",
                    "um.cavuc.com",
                    "mav.mavuz.com",
                    "wofwk.aoidf3.com",
                    "z5.cnzz.com",
                    "xc.hubeijieshikj.cn",
                    "tj.tianwenhu.com",
                    "xg.gars57.cn",
                    "k.jinxiuzhilv.com",
                    "cdn.bootcss.com",
                    "ppl.xunzhuo123.com",
                    "xomk.jiangjunmh.top",
                    "img.xunzhuo123.com",
                    "z1.cnzz.com",
                    "s13.cnzz.com",
                    "xg.huataisangao.cn",
                    "z7.cnzz.com",
                    "xg.huataisangao.cn",
                    "z2.cnzz.com",
                    "s96.cnzz.com",
                    "q11.cnzz.com",
                    "thy.dacedsfa.cn",
                    "xg.whsbpw.cn",
                    "s19.cnzz.com",
                    "z8.cnzz.com",
                    "s4.cnzz.com",
                    "f5w.as12df.top",
                    "ae01.alicdn.com",
                    "www.92424.cn",
                    "k.wudejia.com",
                    "vivovip.mmszxc.top",
                    "qiu.xixiqiu.com",
                    "cdnjs.hnfenxun.com",
                    "cms.qdwght.com"
                ],
                "wallpaper": ""
            };

            // DOM元素
            const tabBtns = document.querySelectorAll('.tab-btn');
            const addVodBtn = document.getElementById('add-vod-btn');
            const updateVodBtn = document.getElementById('update-vod-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const addLiveChannelBtn = document.getElementById('add-live-channel-btn');
            const updateLiveChannelBtn = document.getElementById('update-live-channel-btn');
            const cancelLiveEditBtn = document.getElementById('cancel-live-edit-btn');
            const addParseBtn = document.getElementById('add-parse-btn');
            const updateParseBtn = document.getElementById('update-parse-btn');
            const cancelParseEditBtn = document.getElementById('cancel-parse-edit-btn');
            const addUrlBtn = document.getElementById('add-url-btn');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const configJson = document.getElementById('config-json');
            const vodItems = document.getElementById('vod-items');
            const liveChannelsList = document.getElementById('live-channels-list');
            const parseList = document.getElementById('parse-list');
            const liveUrlsList = document.getElementById('live-urls-list');
            const addCategoryBtn = document.getElementById('add-category-btn');
            const categorySelect = document.getElementById('category-select');
            const categoriesList = document.getElementById('categories-list');
            const parseUrlInput = document.getElementById('parse-url');
            const parseExtInput = document.getElementById('parse-ext');
            const wallpaperUrlInput = document.getElementById('wallpaper-url');
            const liveGroupInput = document.getElementById('live-group');
            const liveChannelNameInput = document.getElementById('live-channel-name');
            const vipFlagsInput = document.getElementById('vip-flags');
            const ijkGroupSelect = document.getElementById('ijk-group');
            const ijkOptionsTextarea = document.getElementById('ijk-options');
            const adDomainsTextarea = document.getElementById('ad-domains');
            const globalSpiderInput = document.getElementById('global-spider');
            const vodExtInput = document.getElementById('vod-ext');
            const vodJarInput = document.getElementById('vod-jar');
            const addIjkOptionBtn = document.querySelector('.add-ijk-option');
            const updateIjkOptionBtn = document.querySelector('.update-ijk-option');
            const cancelIjkEditBtn = document.querySelector('.cancel-ijk-edit');
            const ijkCategorySelect = document.querySelector('.ijk-category');
            const ijkNameInput = document.querySelector('.ijk-name');
            const ijkValueInput = document.querySelector('.ijk-value');
            const ijkOptionsList = document.getElementById('ijk-options-list');
            
            // AES加密相关元素
            const aesKeyInput = document.getElementById('aes-key');
            const aesIvInput = document.getElementById('aes-iv');
            const aesResultTextarea = document.getElementById('aes-result');
            const generateAesKeyBtn = document.getElementById('generate-aes-key');
            const generateAesIvBtn = document.getElementById('generate-aes-iv');
            const encryptBtn = document.getElementById('encrypt-btn');
            const copyAesBtn = document.getElementById('copy-aes-btn');
            const downloadAesBtn = document.getElementById('download-aes-btn');

            // 编辑相关变量
            let draggedItem = null;
            let dragStartIndex = -1;
            let editingIndex = -1;
            let editingLiveGroupIndex = -1;
            let editingLiveChannelIndex = -1;
            let editingParseIndex = -1;
            let editingIjkOptionIndex = -1;
            let currentIjkGroup = 'soft';

            // 标签页切换
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.config-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(`${tab}-config`).classList.add('active');
                });
            });

            // ====================== AES 加密逻辑 ======================
            // 生成随机16字节字符串（ASCII可打印字符）
            function generateRandomKey() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let result = '';
                for (let i = 0; i < 16; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            }

            // 生成随机Key/IV
            generateAesKeyBtn.addEventListener('click', () => {
                aesKeyInput.value = generateRandomKey();
            });
            
            generateAesIvBtn.addEventListener('click', () => {
                aesIvInput.value = generateRandomKey();
            });

            // AES-128-CBC 加密函数（兼容影视仓）
            function encryptForTVBox(text, key, iv) {
                try {
                    const keyBytes = CryptoJS.enc.Utf8.parse(key);
                    const ivBytes = CryptoJS.enc.Utf8.parse(iv);
                    
                    const encrypted = CryptoJS.AES.encrypt(text, keyBytes, {
                        iv: ivBytes,
                        mode: CryptoJS.mode.CBC,
                        padding: CryptoJS.pad.Pkcs7
                    });
                    
                    return encrypted.toString(); // 自动转为Base64
                } catch (error) {
                    console.error('加密失败:', error);
                    return null;
                }
            }

            // 加密按钮事件
            encryptBtn.addEventListener('click', () => {
                const key = aesKeyInput.value.trim();
                const iv = aesIvInput.value.trim();
                
                if (key.length !== 16 || iv.length !== 16) {
                    alert('密钥(Key)和初始向量(IV)必须为16字节！');
                    return;
                }
                
                const jsonStr = JSON.stringify(config, null, 2);
                const encrypted = encryptForTVBox(jsonStr, key, iv);
                
                if (encrypted) {
                    aesResultTextarea.value = encrypted;
                    alert('加密成功！请复制或下载加密结果。');
                } else {
                    alert('加密失败，请检查输入参数！');
                }
            });

            // 复制加密结果
            copyAesBtn.addEventListener('click', async () => {
                if (!aesResultTextarea.value) {
                    alert("请先加密配置！");
                    return;
                }
                try {
                    await navigator.clipboard.writeText(aesResultTextarea.value);
                    alert('✅ 已复制到剪贴板！');
                } catch (err) {
                    console.error("复制失败:", err);
                    aesResultTextarea.select();
                    document.execCommand('copy');
                    alert('✅ 已使用兼容模式复制！');
                }
            });

            // 下载加密文件
            downloadAesBtn.addEventListener('click', () => {
                if (!aesResultTextarea.value) {
                    alert("请先加密配置！");
                    return;
                }
                const blob = new Blob([aesResultTextarea.value], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tvbox_encrypted_config.txt';
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            });

            // ====================== 原有功能逻辑 ======================
            // ...（保持原有的点播源、直播源等所有功能代码不变）...
            // 注意：这里应包含您原有代码中的所有功能函数，如：
            // - loadVodItems()
            // - loadLiveChannels()
            // - loadParses()
            // - updateConfigJson()
            // - 等等...

            // 初始化表单值
            function initFormValues() {
                if (config.spider) {
                    globalSpiderInput.value = config.spider;
                }
                
                // 设置VIP标识默认值
                vipFlagsInput.value = config.flags.join(',');
                
                // 初始化IJK配置显示
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // 设置广告过滤默认值
                adDomainsTextarea.value = config.ads.join('\n');
                
                // 加载分类
                loadCategories();
                
                // 加载列表
                loadVodItems();
                loadLiveChannels();
                loadParses();
                
                // 初始化URL删除事件
                document.querySelectorAll('.remove-url').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.parentElement.remove();
                    });
                });
            }

            // 初始化页面
            initFormValues();
            updateConfigJson();
        });
    </script>
</body>
</html>