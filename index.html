<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TVBOXæ¥å£é…ç½®ç¼–è¾‘å™¨</title>
    <style>
        :root {
            --primary-color: #4a6baf;
            --secondary-color: #5a8dee;
            --accent-color: #ff7043;
            --success-color: #4caf50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            --light-color: #f5f7fa;
            --dark-color: #263238;
            --text-color: #455a64;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f8f9fa;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            touch-action: manipulation;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 15px var(--shadow-color);
            overflow: hidden;
            padding: 25px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            color: var(--primary-color);
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .warning {
            color: var(--danger-color);
            background-color: rgba(244, 67, 54, 0.1);
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 8px;
            background-color: var(--light-color);
            padding: 8px;
            border-radius: 6px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-color);
        }
        
        .tab-btn:hover {
            background-color: rgba(74, 107, 175, 0.1);
            color: var(--primary-color);
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(74, 107, 175, 0.3);
        }
        
        .instruction {
            color: var(--text-color);
            background-color: rgba(90, 141, 238, 0.1);
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 15px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .config-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: none;
        }
        
        .config-section.active {
            display: block;
        }
        
        /* å¿«é€ŸåŒ¹é…ä¿¡æ¯æ ·å¼ */
        .quick-match-container {
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        
        .quick-match-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .quick-match-header:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }
        
        .quick-match-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
        }
        
        .quick-match-header .icon {
            transition: transform 0.3s ease;
            font-size: 14px;
            color: white;
        }
        
        .quick-match-header.expanded .icon {
            transform: rotate(180deg);
        }
        
        .quick-match-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            background-color: var(--light-color);
        }
        
        .quick-match-content.expanded {
            padding: 15px;
            max-height: 500px;
        }
        
        .quick-match-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            margin-bottom: 12px;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        .quick-match-textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(90, 141, 238, 0.2);
        }
        
        .quick-match-buttons {
            display: flex;
            gap: 10px;
        }
        
        .quick-match-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
        }
        
        .quick-match-btn:hover {
            background-color: #43a047;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        .quick-match-clear-btn {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .quick-match-clear-btn:hover {
            background-color: #f57c00;
            box-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);
        }
        
        /* ç‚¹æ’­æºå¯¼èˆªæ æ ·å¼ - ä¿®å¤å¸ƒå±€é—®é¢˜ */
        .vod-navigation {
            margin-top: 20px;
            margin-bottom: 25px;
            padding: 15px;
            background-color: var(--light-color);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }
        
        .vod-navigation h4 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 16px;
            display: flex;
            align-items: center;
        }
        
        .vod-navigation h4 i {
            margin-right: 8px;
            font-size: 18px;
        }
        
        .vod-nav-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
        }
        
        .vod-nav-btn {
            padding: 8px 16px;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            user-select: none;
            position: relative;
            text-align: center;
            min-height: 36px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        .vod-nav-btn:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(74, 107, 175, 0.3);
        }
        
        .vod-nav-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .vod-nav-btn.dragging {
            opacity: 0.5;
            border: 2px dashed var(--primary-color);
            z-index: 10;
            transform: none !important;
        }
        
        .vod-nav-btn.drag-over {
            border: 2px solid var(--primary-color);
            background-color: rgba(74, 107, 175, 0.1);
        }
        
        /* åŠ è§£å¯†å·¥å…·æ ·å¼ */
        .crypto-wrapper {
            display: flex;
            gap: 20px;
            align-items: stretch;
        }
        
        .crypto-textarea-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .crypto-textarea-group textarea {
            flex: 1;
            min-height: 200px;
            font-family: monospace;
        }
        
        .crypto-control-group {
            width: 280px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .crypto-form-control {
            margin-bottom: 15px;
        }
        
        .crypto-form-control label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .crypto-form-control input[type="text"] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        
        .crypto-btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .crypto-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
        }
        
        .crypto-btn-encrypt {
            background-color: var(--success-color);
            color: white;
        }
        
        .crypto-btn-decrypt {
            background-color: var(--info-color);
            color: white;
        }
        
        .crypto-btn-copy {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .crypto-btn-clear {
            background-color: var(--danger-color);
            color: white;
        }
        
        .crypto-btn-upload {
            background-color: var(--primary-color) !important;
            color: white !important;
        }
        
        .crypto-btn-process {
            background-color: var(--success-color);
            color: white;
        }
        
        .crypto-checkbox-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .crypto-checkbox-group input {
            margin-right: 8px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* å…¶ä»–åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
        .config-section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            font-size: 20px;
        }
        
        .config-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .config-label {
            min-width: 120px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            flex: 1;
            min-width: 250px;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(90, 141, 238, 0.2);
        }
        
        textarea {
            min-height: 120px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            line-height: 1.5;
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(74, 107, 175, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .button-edit {
            background-color: var(--info-color);
        }
        
        .button-cancel {
            background-color: var(--danger-color);
        }
        
        .button-success {
            background-color: var(--success-color);
        }
        
        .button-warning {
            background-color: var(--warning-color);
        }
        
        .source-list {
            margin-top: 25px;
            width: 100%;
        }
        
        .source-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            cursor: move;
            position: relative;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .source-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .source-item.dragging {
            opacity: 0.7;
            border: 2px dashed var(--primary-color);
            background-color: rgba(90, 141, 238, 0.1);
        }
        
        .drag-handle {
            margin-right: 15px;
            cursor: move;
            color: var(--text-color);
            font-size: 18px;
        }
        
        .source-item h4 {
            color: var(--dark-color);
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .source-item p {
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .source-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .category-config {
            margin-top: 20px;
            width: 100%;
        }
        
        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .category-tag {
            background-color: rgba(90, 141, 238, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            font-size: 13px;
            color: var(--primary-color);
        }
        
        .category-tag button {
            margin-left: 8px;
            padding: 2px 6px;
            background-color: var(--danger-color);
            font-size: 12px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            min-width: auto;
        }
        
        .url-list {
            margin-top: 15px;
            width: 100%;
        }
        
        .url-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .url-item input {
            flex: 1;
        }
        
        .url-item button {
            padding: 8px 12px;
            min-width: auto;
        }
        
        .json-output {
            margin-top: 30px;
            width: 100%;
        }
        
        .json-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .json-header h3 {
            color: var(--primary-color);
            font-size: 18px;
        }
        
        #config-json {
            width: 100%;
            height: 200px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            /* ç§»é™¤é»˜è®¤éšè—ï¼Œæ”¹ä¸ºé€šè¿‡classæ§åˆ¶ */
        }
        
        .json-toggle-btn {
            margin-left: 10px;
            background-color: var(--primary-color) !important; /* ç¡®ä¿é¢œè‰²ä¸å¤åˆ¶æŒ‰é’®ä¸€è‡´ */
        }
        
        .channel-item,
        .parse-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            cursor: move;
        }
        
        .channel-item.dragging,
        .parse-item.dragging {
            opacity: 0.7;
            border: 2px dashed var(--primary-color);
            background-color: rgba(90, 141, 238, 0.1);
        }
        
        .channel-item p,
        .parse-item p {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .channel-item-actions,
        .parse-item-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 8px;
        }
        
        .ijk-option-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .ijk-option-item select,
        .ijk-option-item input {
            flex: 1;
            min-width: 200px;
        }
        
        .ijk-option-item button {
            padding: 8px 12px;
            min-width: auto;
        }

        /* æ–°å¢è‡ªå®šä¹‰å­—æ®µæ ·å¼ */
        .custom-fields-container {
            margin-top: 15px;
            width: 100%;
        }

        .custom-field-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .custom-field-item input[type="text"] {
            flex: 1;
            min-width: 200px;
        }

        .custom-field-item button {
            padding: 8px 12px;
            min-width: auto;
        }

        .add-custom-field-btn {
            margin-top: 10px;
        }
        
        /* è‡ªå®šä¹‰åˆ†ç±»è¾“å…¥æ¡†æ ·å¼ */
        .custom-category-input {
            flex: 1;
            min-width: 200px;
        }
        
        /* ä¿®æ”¹ç‚¹æ’­æºåˆ—è¡¨ä½ç½® */
        .vod-items-container {
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        /* ä¸Šä¼ æ–‡ä»¶æŒ‰é’®æ ·å¼ */
        .upload-json-btn {
            background-color: var(--info-color) !important;
        }
        
        .upload-json-input {
            display: none;
        }
        
        /* æ–°å¢è‹±æ–‡æ ‡ç­¾æ ·å¼ */
        .english-label {
            color: #999;
            font-size: 12px;
            margin-left: 8px;
            font-weight: normal;
        }
        
        /* å›¾ç‰‡é¢„è§ˆç›¸å…³æ ·å¼ */
        #image-preview-container {
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
        }

        #image-preview-container img {
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        /* å›¾ç‰‡æŒ‰é’®ç»„æ ·å¼ */
        #crypto-image-btns {
            margin-top: 10px;
        }

        #crypto-image-btns .crypto-btn {
            flex: 1;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 15px;
            }
            
            .config-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .config-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            input[type="text"],
            input[type="number"],
            select,
            textarea {
                width: 100%;
                min-width: 100%;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
            
            .json-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .ijk-option-item select,
            .ijk-option-item input {
                width: 100%;
                min-width: 100%;
            }
            
            /* å“åº”å¼åŠ è§£å¯†å·¥å…·æ ·å¼ */
            .crypto-wrapper {
                flex-direction: column;
            }
            
            .crypto-control-group {
                width: 100%;
                order: -1;
                margin-bottom: 15px;
            }

            /* å“åº”å¼è‡ªå®šä¹‰å­—æ®µæ ·å¼ */
            .custom-field-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .custom-field-item input[type="text"] {
                width: 100%;
                min-width: 100%;
            }
            
            /* å“åº”å¼è‡ªå®šä¹‰åˆ†ç±»æ ·å¼ */
            .custom-category-input {
                width: 100%;
                min-width: 100%;
            }
            
            /* å“åº”å¼è‹±æ–‡æ ‡ç­¾æ ·å¼ */
            .english-label {
                margin-left: 5px;
                font-size: 11px;
            }
            
            /* å“åº”å¼ç‚¹æ’­æºå¯¼èˆªæ ·å¼ - ä¿æŒä¸‰æ’å¸ƒå±€ */
            .vod-nav-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .vod-nav-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            /* å“åº”å¼å¿«é€ŸåŒ¹é…æŒ‰é’®æ ·å¼ */
            .quick-match-buttons {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            /* åœ¨è¶…å°å±å¹•ä¸Šä¿æŒä¸‰æ’å¸ƒå±€ */
            .vod-nav-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .vod-nav-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TVBOXæ¥å£é…ç½®ç¼–è¾‘å™¨</h1>
            <div class="warning">è¿”å›æˆ–è€…å…³é—­æµè§ˆå™¨å°†ä¼šä¸¢å¤±è®°å½•ï¼Œè°¨æ…æ“ä½œï¼</div>
        </div>

        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="vod">ç‚¹æ’­æº</button>
            <button class="tab-btn" data-tab="live">ç›´æ’­æº</button>
            <button class="tab-btn" data-tab="parse">è§£æåœ°å€</button>
            <button class="tab-btn" data-tab="vip">VIPè§£ææ ‡è¯†</button>
            <button class="tab-btn" data-tab="ijk">IJKè§£ç é…ç½®</button>
            <button class="tab-btn" data-tab="ad">è§£æå¹¿å‘Šè¿‡æ»¤</button>
            <button class="tab-btn" data-tab="wallpaper">å£çº¸</button>
            <button class="tab-btn" data-tab="crypto">åŠ è§£å¯†å·¥å…·</button>
        </div>

        <div class="instruction">
            <i class="icon-info"></i> é…ç½®å¥½åç‚¹å‡»"æ·»åŠ ç‚¹æ’­æº"æŒ‰é’®ï¼Œç„¶åå¤åˆ¶åˆ°å‰ªè´´æ¿å³å¯ï¼
        </div>

        <!-- ä¿®æ”¹åçš„ç‚¹æ’­æºé…ç½®éƒ¨åˆ† -->
        <div class="config-section active" id="vod-config">
            <!-- æ–°å¢å¿«é€ŸåŒ¹é…ä¿¡æ¯åŠŸèƒ½ -->
            <div class="quick-match-container">
                <div class="quick-match-header" id="quick-match-header">
                    <h3>
                        <span class="icon">â–¼</span>
                        <span style="color: #fff;">å¿«é€ŸåŒ¹é…ä¿¡æ¯</span>
                    </h3>
                </div>
                <div class="quick-match-content" id="quick-match-content">
                    <textarea class="quick-match-textarea" id="quick-match-textarea" placeholder="è¯·åœ¨æ­¤å¤„ç²˜è´´ç‚¹æ’­æºJSONé…ç½®ï¼Œä¾‹å¦‚ï¼š
{
  &quot;key&quot;: &quot;example&quot;,
  &quot;name&quot;: &quot;ç¤ºä¾‹æº&quot;,
  &quot;type&quot;: 1,
  &quot;api&quot;: &quot;http://example.com/api&quot;,
  &quot;searchable&quot;: 1,
  &quot;quickSearch&quot;: 1,
  &quot;filterable&quot;: 1,
  &quot;jar&quot;: &quot;&quot;,
  &quot;ext&quot;: &quot;&quot;
}"></textarea>
                    <div class="quick-match-buttons">
                        <button class="quick-match-btn" id="quick-match-btn">
                            <span>ç¡®å®š</span>
                        </button>
                        <button class="quick-match-btn quick-match-clear-btn" id="quick-match-clear-btn">
                            <span>æ¸…é™¤</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- åŸæœ‰ç‚¹æ’­æºé…ç½®å†…å®¹ -->
            <h3>ç‚¹æ’­æºé…ç½®</h3>
            <div class="config-row">
                <div class="config-label">Spider:</div>
                <input type="text" id="global-spider" placeholder="è‡ªå®šä¹‰çˆ¬è™«jarä»£ç åŒ…(ä¸éœ€è¦ç•™ç©ºå³å¯)">
            </div>
            <div class="config-row">
                <div class="config-label">Key:</div>
                <input type="text" id="vod-key" placeholder="ç‚¹æ’­æºkey">
            </div>
            <div class="config-row">
                <div class="config-label">Name:</div>
                <input type="text" id="vod-name" placeholder="ç‚¹æ’­æºåç§°">
            </div>
            <div class="config-row">
                <div class="config-label">Type:</div>
                <select id="vod-type">
                    <option value="0">0-xml</option>
                    <option value="1" selected>1-json</option>
                    <option value="2">2-çˆ¬è™«æº</option>
                    <option value="3">3-è‡ªå®šä¹‰çˆ¬è™«</option>
                    <option value="4">4-æœåŠ¡å™¨çˆ¬è™«</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">API:</div>
                <input type="text" id="vod-api" placeholder="APIåœ°å€">
            </div>
            <div class="config-row">
                <div class="config-label">JAR:</div>
                <input type="text" id="vod-jar" placeholder="è‡ªå®šä¹‰JARåŒ…åœ°å€(ä¸éœ€è¦ç•™ç©ºå³å¯)">
            </div>
            <div class="config-row">
                <div class="config-label">å¯æœç´¢:<span class="english-label">(searchable)</span></div>
                <select id="vod-searchable">
                    <option value="0">0-ä¸å¯ä»¥</option>
                    <option value="1" selected>1-å¯ä»¥</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">å¯å¿«é€Ÿæœç´¢:<span class="english-label">(quickSearch)</span></div>
                <select id="vod-quickSearch">
                    <option value="0">0-ä¸å¯ä»¥</option>
                    <option value="1" selected>1-å¯ä»¥</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">å¯ç­›é€‰:<span class="english-label">(filterable)</span></div>
                <select id="vod-filterable">
                    <option value="0">0-ä¸å¯ä»¥</option>
                    <option value="1" selected>1-å¯ä»¥</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">Ext:</div>
                <input type="text" id="vod-ext" placeholder="æ‰©å±•å‚æ•°(å¯é€‰)">
            </div>
            
            <!-- æ–°å¢è‡ªå®šä¹‰å­—æ®µåŒºåŸŸ -->
            <div class="config-row">
                <div class="config-label">è‡ªå®šä¹‰å­—æ®µ:</div>
                <div style="flex: 1;">
                    <div class="custom-fields-container" id="custom-fields-container">
                        <!-- è‡ªå®šä¹‰å­—æ®µå°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                    </div>
                    <button id="add-custom-field-btn" class="button-success add-custom-field-btn">æ·»åŠ è‡ªå®šä¹‰å­—æ®µ</button>
                </div>
            </div>
            
            <div class="category-config">
                <h3>åˆ†ç±»é…ç½®</h3>
                <p>æŒ‰é¡ºåºå±•ç¤ºæ‰€é…ç½®çš„åˆ†ç±»ï¼Œä¸é…ç½®åˆ™é»˜è®¤å±•ç¤ºæ‰€æœ‰åˆ†ç±»</p>
                <div class="config-row">
                    <div class="config-label">æ·»åŠ åˆ†ç±»:</div>
                    <div style="flex: 1; display: flex; gap: 10px; flex-wrap: wrap;">
                        <select id="category-select">
                            <option value="ç”µå½±ç‰‡">ç”µå½±ç‰‡</option>
                            <option value="è¿ç»­å‰§">è¿ç»­å‰§</option>
                            <option value="ç»¼è‰ºç‰‡">ç»¼è‰ºç‰‡</option>
                            <option value="åŠ¨æ¼«ç‰‡">åŠ¨æ¼«ç‰‡</option>
                            <option value="åŠ¨ä½œç‰‡">åŠ¨ä½œç‰‡</option>
                            <option value="å–œå‰§ç‰‡">å–œå‰§ç‰‡</option>
                            <option value="çˆ±æƒ…ç‰‡">çˆ±æƒ…ç‰‡</option>
                            <option value="ç§‘å¹»ç‰‡">ç§‘å¹»ç‰‡</option>
                            <option value="ææ€–ç‰‡">ææ€–ç‰‡</option>
                            <option value="å‰§æƒ…ç‰‡">å‰§æƒ…ç‰‡</option>
                            <option value="æˆ˜äº‰ç‰‡">æˆ˜äº‰ç‰‡</option>
                            <option value="å›½äº§å‰§">å›½äº§å‰§</option>
                            <option value="é¦™æ¸¯å‰§">é¦™æ¸¯å‰§</option>
                            <option value="éŸ©å›½å‰§">éŸ©å›½å‰§</option>
                            <option value="æ¬§ç¾å‰§">æ¬§ç¾å‰§</option>
                            <option value="çºªå½•ç‰‡">çºªå½•ç‰‡</option>
                            <option value="æ—¥æœ¬å‰§">æ—¥æœ¬å‰§</option>
                            <option value="æµ·å¤–å‰§">æµ·å¤–å‰§</option>
                            <option value="æ³°å›½å‰§">æ³°å›½å‰§</option>
                            <option value="å¤§é™†ç»¼è‰º">å¤§é™†ç»¼è‰º</option>
                            <option value="æ¸¯å°ç»¼è‰º">æ¸¯å°ç»¼è‰º</option>
                            <option value="æ—¥éŸ©ç»¼è‰º">æ—¥éŸ©ç»¼è‰º</option>
                            <option value="æ¬§ç¾ç»¼è‰º">æ¬§ç¾ç»¼è‰º</option>
                            <option value="å›½äº§åŠ¨æ¼«">å›½äº§åŠ¨æ¼«</option>
                            <option value="æ—¥éŸ©åŠ¨æ¼«">æ—¥éŸ©åŠ¨æ¼«</option>
                            <option value="æ¬§ç¾åŠ¨æ¼«">æ¬§ç¾åŠ¨æ¼«</option>
                            <option value="æ¸¯å°åŠ¨æ¼«">æ¸¯å°åŠ¨æ¼«</option>
                            <option value="æµ·å¤–åŠ¨æ¼«">æµ·å¤–åŠ¨æ¼«</option>
                            <option value="ä¼¦ç†ç‰‡">ä¼¦ç†ç‰‡</option>
                            <option value="çŸ­å‰§">çŸ­å‰§</option>
                        </select>
                        <input type="text" id="custom-category" class="custom-category-input" placeholder="æˆ–è¾“å…¥è‡ªå®šä¹‰åˆ†ç±»">
                        <button id="add-category-btn">æ·»åŠ </button>
                    </div>
                </div>
                <div class="category-list" id="categories-list"></div>
            </div>

            <!-- ç§»åŠ¨åˆ°æ­¤å¤„çš„æŒ‰é’®ç»„ -->
            <div class="button-group">
                <button id="add-vod-btn" class="button-success">æ·»åŠ ç‚¹æ’­æº</button>
                <button id="upload-json-btn" class="upload-json-btn">ä¸Šä¼ JSON</button>
                <input type="file" id="upload-json-input" class="upload-json-input" accept=".json">
                <button id="update-vod-btn" class="button-edit" style="display:none;">æ›´æ–°ç‚¹æ’­æº</button>
                <button id="cancel-edit-btn" class="button-cancel" style="display:none;">å–æ¶ˆç¼–è¾‘</button>
            </div>

            <!-- æ–°å¢ç‚¹æ’­æºå¯¼èˆªæ  -->
            <div class="vod-navigation" id="vod-navigation" style="display: none;">
                <h4><i>ğŸ“º</i> ç‚¹æ’­æºå¯¼èˆª</h4>
                <div class="vod-nav-buttons" id="vod-nav-buttons">
                    <!-- ç‚¹æ’­æºå¯¼èˆªæŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ç‚¹æ’­æºåˆ—è¡¨å®¹å™¨ -->
            <div class="vod-items-container" id="vod-items"></div>

            <!-- ç§»åŠ¨åˆ°æ­¤å¤„çš„JSONè¾“å‡ºéƒ¨åˆ† -->
            <div class="json-output">
                <div class="json-header">
                    <h3>ç”Ÿæˆçš„é…ç½®JSON</h3>
                    <div>
                        <button id="copy-btn" class="button-success">å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
                        <button id="toggle-json-btn" class="button-success json-toggle-btn">æ˜¾ç¤ºJSON</button>
                    </div>
                </div>
                <textarea id="config-json" class="hidden" readonly></textarea>
            </div>
        </div>

        <!-- å…¶ä»–åŸæœ‰é…ç½®éƒ¨åˆ†ä¿æŒä¸å˜ -->
        <div class="config-section" id="live-config">
            <!-- åŸæœ‰ç›´æ’­æºé…ç½®å†…å®¹ -->
            <h3>ç›´æ’­æºé…ç½®</h3>
            <div class="config-row">
                <div class="config-label">ç»„å:</div>
                <input type="text" id="live-group" placeholder="Group">
            </div>
            <div class="config-row">
                <div class="config-label">é¢‘é“å:</div>
                <input type="text" id="live-channel-name" placeholder="name">
            </div>
            <div class="config-row">
                <div class="config-label">ç›´æ’­æºUrls:</div>
                <div style="flex: 1;">
                    <div class="url-list" id="live-urls-list">
                        <div class="url-item">
                            <input type="text" class="live-url" placeholder="ç›´æ’­æºUrls">
                            <button class="remove-url button-cancel">åˆ é™¤</button>
                        </div>
                    </div>
                    <button id="add-url-btn" class="button-success" style="margin-top: 10px;">æ·»åŠ Urls</button>
                </div>
            </div>
            <div class="button-group">
                <button id="add-live-channel-btn" class="button-success">æ·»åŠ é¢‘é“</button>
                <button id="update-live-channel-btn" class="button-edit" style="display:none;">æ›´æ–°é¢‘é“</button>
                <button id="cancel-live-edit-btn" class="button-cancel" style="display:none;">å–æ¶ˆç¼–è¾‘</button>
            </div>
            <div id="live-channels-list"></div>
        </div>

        <div class="config-section" id="parse-config">
            <!-- åŸæœ‰è§£æåœ°å€é…ç½®å†…å®¹ -->
            <h3>è§£æåœ°å€é…ç½®</h3>
            <div class="config-row">
                <div class="config-label">è§£æåç§°:</div>
                <input type="text" id="parse-name" placeholder="è§£æåç§°">
            </div>
            <div class="config-row">
                <div class="config-label">è§£æç±»å‹:</div>
                <select id="parse-type">
                    <option value="0" selected>Type-0 (æ™®é€š)</option>
                    <option value="1">Type-1 (json)</option>
                    <option value="2">Type-2 (å¤šjson)</option>
                    <option value="3">Type-3 (èšåˆ)</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">è§£æURL:</div>
                <input type="text" id="parse-url" placeholder="è§£æURL">
            </div>
            <div class="config-row">
                <div class="config-label">Ext:</div>
                <input type="text" id="parse-ext" placeholder="æ‰©å±•å‚æ•°(å¯é€‰)">
            </div>
            <div class="button-group">
                <button id="add-parse-btn" class="button-success">æ·»åŠ è§£æ</button>
                <button id="update-parse-btn" class="button-edit" style="display:none;">æ›´æ–°è§£æ</button>
                <button id="cancel-parse-edit-btn" class="button-cancel" style="display:none;">å–æ¶ˆç¼–è¾‘</button>
            </div>
            <div id="parse-list"></div>
        </div>

        <div class="config-section" id="vip-config">
            <!-- åŸæœ‰VIPè§£ææ ‡è¯†é…ç½®å†…å®¹ -->
            <h3>VIPè§£ææ ‡è¯†</h3>
            <div class="config-row">
                <div class="config-label">VIPæ ‡è¯†:</div>
                <textarea id="vip-flags" placeholder="å¤šä¸ªæ ‡è¯†ç”¨é€—å·åˆ†éš”">youku,qq,iqiyi,qiyi,letv,sohu,tudou,pptv,mgtv,wasu</textarea>
            </div>
        </div>

        <div class="config-section" id="ijk-config">
            <!-- åŸæœ‰IJKè§£ç é…ç½®å†…å®¹ -->
            <h3>IJKè§£ç é…ç½®</h3>
            <div class="config-row">
                <div class="config-label">è§£ç ç»„:</div>
                <select id="ijk-group">
                    <option value="soft">è½¯è§£ç </option>
                    <option value="hard">ç¡¬è§£ç </option>
                </select>
            </div>
            
            <div class="config-row">
                <div class="config-label">æ·»åŠ è§£ç é€‰é¡¹:</div>
                <div style="flex: 1;">
                    <div id="ijk-new-options">
                        <div class="ijk-option-item">
                            <select class="ijk-category">
                                <option value="1">1-OPT_CATEGORY_FORMAT</option>
                                <option value="2">2-OPT_CATEGORY_CODEC</option>
                                <option value="3">3-OPT_CATEGORY_SWS</option>
                                <option value="4" selected>4-OPT_CATEGORY_PLAYER</option>
                            </select>
                            <input type="text" class="ijk-name" placeholder="å±æ€§åç§°" list="ijk-names">
                            <input type="text" class="ijk-value" placeholder="å±æ€§å€¼">
                            <button class="add-ijk-option button-success">æ·»åŠ </button>
                            <button class="update-ijk-option button-edit" style="display:none;">æ›´æ–°</button>
                            <button class="cancel-ijk-edit button-cancel" style="display:none;">å–æ¶ˆ</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <datalist id="ijk-names">
                <option value="opensles">
                <option value="overlay-format">
                <option value="framedrop">
                <option value="soundtouch">
                <option value="start-on-prepared">
                <option value="http-detect-range-support">
                <option value="fflags">
                <option value="skip_loop_filter">
                <option value="reconnect">
                <option value="max-buffer-size">
                <option value="enable-accurate-seek">
                <option value="mediacodec">
                <option value="mediacodec-auto-rotate">
                <option value="mediacodec-handle-resolution-change">
                <option value="mediacodec-hevc">
            </datalist>
            
            <div class="config-row">
                <div class="config-label">å½“å‰è§£ç é€‰é¡¹:</div>
                <textarea id="ijk-options" placeholder="æ¯è¡Œä¸€ä¸ªé…ç½®é¡¹ï¼Œæ ¼å¼:category|name|value"></textarea>
            </div>
            
            <div id="ijk-options-list"></div>
        </div>

        <div class="config-section" id="ad-config">
            <!-- åŸæœ‰è§£æå¹¿å‘Šè¿‡æ»¤é…ç½®å†…å®¹ -->
            <h3>è§£æå¹¿å‘Šè¿‡æ»¤</h3>
            <div class="config-row">
                <div class="config-label">å¹¿å‘ŠåŸŸå:</div>
                <textarea id="ad-domains" placeholder="æ¯è¡Œä¸€ä¸ªå¹¿å‘ŠåŸŸå">mimg.0c1q0l.cn
www.googletagmanager.com
www.google-analytics.com
mc.usihnbcq.cn
mg.g1mm3d.cn
mscs.svaeuzh.cn
cnzz.hhttm.top
tp.vinuxhome.com
cnzz.mmstat.com
www.baihuillq.com
s23.cnzz.com
z3.cnzz.com
c.cnzz.com
stj.v1vo.top
z12.cnzz.com
img.mosflower.cn
tips.gamevvip.com
ehwe.yhdtns.com
xdn.cqqc3.com
www.jixunkyy.cn
sp.chemacid.cn
hm.baidu.com
s9.cnzz.com
z6.cnzz.com
um.cavuc.com
mav.mavuz.com
wofwk.aoidf3.com
z5.cnzz.com
xc.hubeijieshikj.cn
tj.tianwenhu.com
xg.gars57.cn
k.jinxiuzhilv.com
cdn.bootcss.com
ppl.xunzhuo123.com
xomk.jiangjunmh.top
img.xunzhuo123.com
z1.cnzz.com
s13.cnzz.com
xg.huataisangao.cn
z7.cnzz.com
xg.huataisangao.cn
z2.cnzz.com
s96.cnzz.com
q11.cnzz.com
thy.dacedsfa.cn
xg.whsbpw.cn
s19.cnzz.com
z8.cnzz.com
s4.cnzz.com
f5w.as12df.top
ae01.alicdn.com
www.92424.cn
k.wudejia.com
vivovip.mmszxc.top
qiu.xixiqiu.com
cdnjs.hnfenxun.com
cms.qdwght.com</textarea>
            </div>
        </div>

        <div class="config-section" id="wallpaper-config">
            <!-- åŸæœ‰å£çº¸é…ç½®å†…å®¹ -->
            <h3>å£çº¸é…ç½®</h3>
            <div class="config-row">
                <div class="config-label">å£çº¸URL:</div>
                <input type="text" id="wallpaper-url" placeholder="å£çº¸URL">
            </div>
        </div>

        <!-- ä¿®æ”¹åçš„åŠ è§£å¯†å·¥å…·éƒ¨åˆ† -->
        <div class="config-section" id="crypto-config">
            <h3>TVBOXæ¥å£åŠ è§£å¯†å·¥å…·</h3>
            <div class="crypto-wrapper">
                <!-- å·¦ä¾§è¾“å…¥æ¡† -->
                <div class="crypto-textarea-group">
                    <textarea id="crypto-input" placeholder="è¯·è¾“å…¥è¦åŠ å¯†/è§£å¯†çš„æ–‡æœ¬"></textarea>
                </div>
                
                <!-- ä¸­é—´æ§åˆ¶é¢æ¿ -->
                <div class="crypto-control-group">
                    <div class="crypto-form-control">
                        <label for="crypto-operation">æ“ä½œç±»å‹</label>
                        <select id="crypto-operation">
                            <option value="encrypt">åŠ å¯†</option>
                            <option value="decrypt">è§£å¯†</option>
                        </select>
                    </div>
                    
                    <div class="crypto-form-control">
                        <label for="crypto-image-source">å›¾ç‰‡æº</label>
                        <select id="crypto-image-source">
                            <option value="generate">ç”Ÿæˆæ–°å›¾ç‰‡</option>
                            <option value="existing">ä½¿ç”¨ç°æœ‰å›¾ç‰‡</option>
                        </select>
                    </div>

                    <div class="crypto-form-control" id="existing-image-url-group" style="display: none;">
                        <label for="crypto-image-url">Giteeå›¾ç‰‡URL</label>
                        <input type="text" id="crypto-image-url" placeholder="https://gitee.com/username/repo/raw/master/config.png" value="https://gitee.com/nnoonn1994/lianjiang/raw/master/2C481040-898A-4F00-A55B-8915D5441FF8.png">
                        <button class="crypto-btn crypto-btn-process" id="crypto-fetch-image" style="margin-top: 5px; padding: 5px 10px;">
                            è·å–å›¾ç‰‡
                        </button>
                    </div>
                    
                    <div class="crypto-form-control">
                        <label for="crypto-image-option">è¾“å‡ºæ–¹å¼</label>
                        <select id="crypto-image-option">
                            <option value="text">æ–‡æœ¬è¾“å‡º</option>
                            <option value="image">ç”Ÿæˆå›¾ç‰‡</option>
                        </select>
                    </div>
                    
                    <div class="crypto-form-control">
                        <label for="crypto-key">KEY/å¯†ç </label>
                        <input type="text" id="crypto-key" value="123456" maxlength="16" readonly>
                    </div>
                    
                    <div class="crypto-form-control">
                        <label for="crypto-iv">IV/å‘é‡</label>
                        <input type="text" id="crypto-iv" value="" maxlength="13" readonly>
                    </div>
                    
                    <div class="crypto-checkbox-group hidden" id="crypto-base64-group">
                        <input type="checkbox" id="crypto-base64-check">
                        <label for="crypto-base64-check">Base64è§£ç </label>
                    </div>
                    
                    <div class="crypto-btn-group">
                        <button class="crypto-btn crypto-btn-upload" id="crypto-upload-btn">
                            ä¸Šä¼ æ–‡ä»¶
                        </button>
                        <button class="crypto-btn crypto-btn-process" id="crypto-process-btn">å¤„ç†</button>
                    </div>
                    
                    <input type="file" id="crypto-file-input" style="display: none;">
                    
                    <div class="crypto-btn-group" id="crypto-image-btns" style="display: none;">
                        <button class="crypto-btn crypto-btn-upload" id="crypto-download-img">
                            ä¸‹è½½å›¾ç‰‡
                        </button>
                        <button class="crypto-btn crypto-btn-process" id="crypto-copy-img">
                            å¤åˆ¶å›¾ç‰‡
                        </button>
                        <button class="crypto-btn crypto-btn-encrypt" id="crypto-upload-gitee">
                            ç”ŸæˆGiteeé…ç½®
                        </button>
                    </div>

                    <div class="crypto-btn-group">
                        <button class="crypto-btn crypto-btn-copy" id="crypto-copy-btn">å¤åˆ¶</button>
                        <button class="crypto-btn crypto-btn-clear" id="crypto-clear-btn">æ¸…é™¤</button>
                    </div>
                </div>
                
                <!-- å³ä¾§ç»“æœæ¡† -->
                <div class="crypto-textarea-group">
                    <textarea id="crypto-output" placeholder="å¤„ç†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ" readonly></textarea>
                </div>
            </div>
        </div>
    </div>

    <canvas id="crypto-canvas" style="display: none;"></canvas>

    <!-- Giteeé…ç½®ç”Ÿæˆæ¨¡æ€æ¡† -->
    <div id="gitee-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%;">
            <h3>Giteeå›¾ç‰‡é…ç½®ç”Ÿæˆ</h3>
            <div class="config-row">
                <div class="config-label">å›¾ç‰‡URL:</div>
                <input type="text" id="gitee-image-url" readonly>
            </div>
            <div class="config-row">
                <div class="config-label">TVBOXé…ç½®:</div>
                <textarea id="gitee-tvbox-config" rows="4" readonly></textarea>
            </div>
            <div class="button-group">
                <button id="copy-gitee-config" class="button-success">å¤åˆ¶é…ç½®</button>
                <button id="close-gitee-modal" class="button-cancel">å…³é—­</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–é…ç½®æ•°æ®
            let config = {
                "spider": "",
                "sites": [],
                "lives": [],
                "parses": [],
                "flags": [
                    "youku",
                    "qq",
                    "iqiyi",
                    "qiyi",
                    "letv",
                    "sohu",
                    "tudou",
                    "pptv",
                    "mgtv",
                    "wasu"
                ],
                "categories": [], // ä¿®æ”¹ä¸ºé»˜è®¤ç©ºæ•°ç»„
                "ijk": [
                    {
                        "group": "è½¯è§£ç ",
                        "options": [
                            {
                                "category": 4,
                                "name": "opensles",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "overlay-format",
                                "value": "842225234"
                            },
                            {
                                "category": 4,
                                "name": "framedrop",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "soundtouch",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "start-on-prepared",
                                "value": "1"
                            },
                            {
                                "category": 1,
                                "name": "http-detect-range-support",
                                "value": "0"
                            },
                            {
                                "category": 1,
                                "name": "fflags",
                                "value": "fastseek"
                            },
                            {
                                "category": 2,
                                "name": "skip_loop_filter",
                                "value": "48"
                            },
                            {
                                "category": 4,
                                "name": "reconnect",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "max-buffer-size",
                                "value": "5242880"
                            },
                            {
                                "category": 4,
                                "name": "enable-accurate-seek",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-auto-rotate",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-handle-resolution-change",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-hevc",
                                "value": "0"
                            }
                        ]
                    },
                    {
                        "group": "ç¡¬è§£ç ",
                        "options": [
                            {
                                "category": 4,
                                "name": "opensles",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "overlay-format",
                                "value": "842225234"
                            },
                            {
                                "category": 4,
                                "name": "framedrop",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "soundtouch",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "start-on-prepared",
                                "value": "1"
                            },
                            {
                                "category": 1,
                                "name": "http-detect-range-support",
                                "value": "0"
                            },
                            {
                                "category": 1,
                                "name": "fflags",
                                "value": "fastseek"
                            },
                            {
                                "category": 2,
                                "name": "skip_loop_filter",
                                "value": "48"
                            },
                            {
                                "category": 4,
                                "name": "reconnect",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "max-buffer-size",
                                "value": "5242880"
                            },
                            {
                                "category": 4,
                                "name": "enable-accurate-seek",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-auto-rotate",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-handle-resolution-change",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-hevc",
                                "value": "1"
                            }
                        ]
                    }
                ],
                "ads": [
                    "mimg.0c1q0l.cn",
                    "www.googletagmanager.com",
                    "www.google-analytics.com",
                    "mc.usihnbcq.cn",
                    "mg.g1mm3d.cn",
                    "mscs.svaeuzh.cn",
                    "cnzz.hhttm.top",
                    "tp.vinuxhome.com",
                    "cnzz.mmstat.com",
                    "www.baihuillq.com",
                    "s23.cnzz.com",
                    "z3.cnzz.com",
                    "c.cnzz.com",
                    "stj.v1vo.top",
                    "z12.cnzz.com",
                    "img.mosflower.cn",
                    "tips.gamevvip.com",
                    "ehwe.yhdtns.com",
                    "xdn.cqqc3.com",
                    "www.jixunkyy.cn",
                    "sp.chemacid.cn",
                    "hm.baidu.com",
                    "s9.cnzz.com",
                    "z6.cnzz.com",
                    "um.cavuc.com",
                    "mav.mavuz.com",
                    "wofwk.aoidf3.com",
                    "z5.cnzz.com",
                    "xc.hubeijieshikj.cn",
                    "tj.tianwenhu.com",
                    "xg.gars57.cn",
                    "k.jinxiuzhilv.com",
                    "cdn.bootcss.com",
                    "ppl.xunzhuo123.com",
                    "xomk.jiangjunmh.top",
                    "img.xunzhuo123.com",
                    "z1.cnzz.com",
                    "s13.cnzz.com",
                    "xg.huataisangao.cn",
                    "z7.cnzz.com",
                    "xg.huataisangao.cn",
                    "z2.cnzz.com",
                    "s96.cnzz.com",
                    "q11.cnzz.com",
                    "thy.dacedsfa.cn",
                    "xg.whsbpw.cn",
                    "s19.cnzz.com",
                    "z8.cnzz.com",
                    "s4.cnzz.com",
                    "f5w.as12df.top",
                    "ae01.alicdn.com",
                    "www.92424.cn",
                    "k.wudejia.com",
                    "vivovip.mmszxc.top",
                    "qiu.xixiqiu.com",
                    "cdnjs.hnfenxun.com",
                    "cms.qdwght.com"
                ],
                "wallpaper": ""
            };

            // DOMå…ƒç´ 
            const tabBtns = document.querySelectorAll('.tab-btn');
            const addVodBtn = document.getElementById('add-vod-btn');
            const uploadJsonBtn = document.getElementById('upload-json-btn');
            const uploadJsonInput = document.getElementById('upload-json-input');
            const updateVodBtn = document.getElementById('update-vod-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const addLiveChannelBtn = document.getElementById('add-live-channel-btn');
            const updateLiveChannelBtn = document.getElementById('update-live-channel-btn');
            const cancelLiveEditBtn = document.getElementById('cancel-live-edit-btn');
            const addParseBtn = document.getElementById('add-parse-btn');
            const updateParseBtn = document.getElementById('update-parse-btn');
            const cancelParseEditBtn = document.getElementById('cancel-parse-edit-btn');
            const addUrlBtn = document.getElementById('add-url-btn');
            const copyBtn = document.getElementById('copy-btn');
            const toggleJsonBtn = document.getElementById('toggle-json-btn');
            const configJson = document.getElementById('config-json');
            const vodItems = document.getElementById('vod-items');
            const liveChannelsList = document.getElementById('live-channels-list');
            const parseList = document.getElementById('parse-list');
            const liveUrlsList = document.getElementById('live-urls-list');
            const addCategoryBtn = document.getElementById('add-category-btn');
            const categorySelect = document.getElementById('category-select');
            const customCategoryInput = document.getElementById('custom-category');
            const categoriesList = document.getElementById('categories-list');
            const parseUrlInput = document.getElementById('parse-url');
            const parseExtInput = document.getElementById('parse-ext');
            const wallpaperUrlInput = document.getElementById('wallpaper-url');
            const liveGroupInput = document.getElementById('live-group');
            const liveChannelNameInput = document.getElementById('live-channel-name');
            const vipFlagsInput = document.getElementById('vip-flags');
            const ijkGroupSelect = document.getElementById('ijk-group');
            const ijkOptionsTextarea = document.getElementById('ijk-options');
            const adDomainsTextarea = document.getElementById('ad-domains');
            const globalSpiderInput = document.getElementById('global-spider');
            const vodExtInput = document.getElementById('vod-ext');
            const vodJarInput = document.getElementById('vod-jar');
            const addIjkOptionBtn = document.querySelector('.add-ijk-option');
            const updateIjkOptionBtn = document.querySelector('.update-ijk-option');
            const cancelIjkEditBtn = document.querySelector('.cancel-ijk-edit');
            const ijkCategorySelect = document.querySelector('.ijk-category');
            const ijkNameInput = document.querySelector('.ijk-name');
            const ijkValueInput = document.querySelector('.ijk-value');
            const ijkOptionsList = document.getElementById('ijk-options-list');
            const addCustomFieldBtn = document.getElementById('add-custom-field-btn');
            const customFieldsContainer = document.getElementById('custom-fields-container');

            // æ–°å¢ç‚¹æ’­æºå¯¼èˆªç›¸å…³DOMå…ƒç´ 
            const vodNavigation = document.getElementById('vod-navigation');
            const vodNavButtons = document.getElementById('vod-nav-buttons');

            // åŠ è§£å¯†å·¥å…·ç›¸å…³DOMå…ƒç´ 
            const cryptoOperationSelect = document.getElementById('crypto-operation');
            const cryptoBase64Group = document.getElementById('crypto-base64-group');
            const cryptoBase64Check = document.getElementById('crypto-base64-check');
            const cryptoProcessBtn = document.getElementById('crypto-process-btn');
            const cryptoCopyBtn = document.getElementById('crypto-copy-btn');
            const cryptoClearBtn = document.getElementById('crypto-clear-btn');
            const cryptoInput = document.getElementById('crypto-input');
            const cryptoOutput = document.getElementById('crypto-output');
            const cryptoKeyInput = document.getElementById('crypto-key');
            const cryptoIvInput = document.getElementById('crypto-iv');
            const cryptoUploadBtn = document.getElementById('crypto-upload-btn');
            const cryptoFileInput = document.getElementById('crypto-file-input');

            // å¿«é€ŸåŒ¹é…ä¿¡æ¯ç›¸å…³DOMå…ƒç´ 
            const quickMatchHeader = document.getElementById('quick-match-header');
            const quickMatchContent = document.getElementById('quick-match-content');
            const quickMatchTextarea = document.getElementById('quick-match-textarea');
            const quickMatchBtn = document.getElementById('quick-match-btn');
            const quickMatchClearBtn = document.getElementById('quick-match-clear-btn');

            // å›¾ç‰‡åŠ å¯†ç›¸å…³DOMå…ƒç´ 
            const cryptoImageSource = document.getElementById('crypto-image-source');
            const existingImageUrlGroup = document.getElementById('existing-image-url-group');
            const cryptoImageUrl = document.getElementById('crypto-image-url');
            const cryptoFetchImage = document.getElementById('crypto-fetch-image');
            const cryptoImageOption = document.getElementById('crypto-image-option');
            const cryptoImageBtns = document.getElementById('crypto-image-btns');
            const cryptoDownloadImg = document.getElementById('crypto-download-img');
            const cryptoCopyImg = document.getElementById('crypto-copy-img');
            const cryptoUploadGitee = document.getElementById('crypto-upload-gitee');
            const cryptoCanvas = document.getElementById('crypto-canvas');
            const giteeModal = document.getElementById('gitee-modal');
            const giteeImageUrl = document.getElementById('gitee-image-url');
            const giteeTvboxConfig = document.getElementById('gitee-tvbox-config');
            const copyGiteeConfig = document.getElementById('copy-gitee-config');
            const closeGiteeModal = document.getElementById('close-gitee-modal');

            // ç¼–è¾‘ç›¸å…³å˜é‡
            let draggedItem = null;
            let dragStartIndex = -1;
            let editingIndex = -1;
            let editingLiveGroupIndex = -1;
            let editingLiveChannelIndex = -1;
            let editingParseIndex = -1;
            let editingIjkOptionIndex = -1;
            let currentIjkGroup = 'soft';
            let customFields = {}; // å­˜å‚¨è‡ªå®šä¹‰å­—æ®µ

            // ç‚¹æ’­æºå¯¼èˆªæ‹–æ‹½ç›¸å…³å˜é‡
            let draggedNavBtn = null;
            let dragStartNavIndex = -1;

            // åˆå§‹åŒ–å›¾ç‰‡åŠ å¯†åŠŸèƒ½
            function initImageCrypto() {
                // å›¾ç‰‡æºé€‰æ‹©åˆ‡æ¢
                cryptoImageSource.addEventListener('change', function() {
                    if (this.value === 'existing') {
                        existingImageUrlGroup.style.display = 'block';
                    } else {
                        existingImageUrlGroup.style.display = 'none';
                    }
                });

                // å›¾ç‰‡è¾“å‡ºé€‰é¡¹åˆ‡æ¢
                cryptoImageOption.addEventListener('change', function() {
                    if (this.value === 'image') {
                        cryptoImageBtns.style.display = 'flex';
                        cryptoOutput.style.display = 'none';
                    } else {
                        cryptoImageBtns.style.display = 'none';
                        cryptoOutput.style.display = 'block';
                    }
                });

                // ä»Giteeè·å–å›¾ç‰‡
                cryptoFetchImage.addEventListener('click', async function() {
                    const imageUrl = cryptoImageUrl.value.trim();
                    if (!imageUrl) {
                        alert('è¯·è¾“å…¥Giteeå›¾ç‰‡URL');
                        return;
                    }
                    
                    try {
                        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                        cryptoFetchImage.textContent = 'è·å–ä¸­...';
                        cryptoFetchImage.disabled = true;
                        
                        // è·å–å›¾ç‰‡å¹¶è½¬æ¢ä¸ºBase64
                        const base64Image = await imageUrlToBase64(imageUrl);
                        
                        // å°†Base64å›¾ç‰‡æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†
                        cryptoInput.value = base64Image;
                        
                        alert('å›¾ç‰‡è·å–æˆåŠŸï¼å·²åŠ è½½åˆ°è¾“å…¥æ¡†');
                    } catch (error) {
                        console.error('è·å–å›¾ç‰‡å¤±è´¥:', error);
                        alert('è·å–å›¾ç‰‡å¤±è´¥: ' + error.message);
                    } finally {
                        cryptoFetchImage.textContent = 'è·å–å›¾ç‰‡';
                        cryptoFetchImage.disabled = false;
                    }
                });

                // å¤åˆ¶Giteeé…ç½®
                copyGiteeConfig.addEventListener('click', function() {
                    giteeTvboxConfig.select();
                    document.execCommand('copy');
                    alert('TVBOXé…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });

                // å…³é—­æ¨¡æ€æ¡†
                closeGiteeModal.addEventListener('click', function() {
                    giteeModal.style.display = 'none';
                });
            }

            // å°†å›¾ç‰‡URLè½¬æ¢ä¸ºBase64
            function imageUrlToBase64(url) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = 'Anonymous';
                    
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        try {
                            const base64 = canvas.toDataURL('image/png');
                            resolve(base64);
                        } catch (error) {
                            reject(new Error('å›¾ç‰‡è½¬æ¢å¤±è´¥'));
                        }
                    };
                    
                    img.onerror = function() {
                        reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                    };
                    
                    img.src = url;
                });
            }

            // ç”Ÿæˆé…ç½®å›¾ç‰‡å‡½æ•°
            function generateConfigImage(configText, originalImage = null) {
                return new Promise((resolve) => {
                    const canvas = cryptoCanvas;
                    const ctx = canvas.getContext('2d');
                    
                    if (originalImage) {
                        // ä½¿ç”¨ç°æœ‰å›¾ç‰‡ä½œä¸ºèƒŒæ™¯
                        const img = new Image();
                        img.onload = function() {
                            canvas.width = img.width;
                            canvas.height = img.height;
                            ctx.drawImage(img, 0, 0);
                            
                            // åœ¨å›¾ç‰‡ä¸­åµŒå…¥é…ç½®æ•°æ®
                            embedTextInImage(ctx, configText);
                            canvas.toBlob(resolve, 'image/png');
                        };
                        img.src = originalImage;
                    } else {
                        // ç”Ÿæˆæ–°å›¾ç‰‡
                        const width = 800;
                        const height = 600;
                        canvas.width = width;
                        canvas.height = height;
                        
                        // æ¸…ç©ºç”»å¸ƒ
                        ctx.clearRect(0, 0, width, height);
                        
                        // ç»˜åˆ¶èƒŒæ™¯
                        ctx.fillStyle = '#f5f7fa';
                        ctx.fillRect(0, 0, width, height);
                        
                        // ç»˜åˆ¶æ ‡é¢˜
                        ctx.fillStyle = '#4a6baf';
                        ctx.font = 'bold 24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('TVBOX æ¥å£é…ç½®', width / 2, 50);
                        
                        // ç»˜åˆ¶é…ç½®å†…å®¹
                        ctx.fillStyle = '#455a64';
                        ctx.font = '14px Consolas, Monaco, monospace';
                        ctx.textAlign = 'left';
                        
                        // æ–‡æœ¬æ¢è¡Œå¤„ç†
                        const lines = wrapText(ctx, configText, 50, 100, width - 100, 20);
                        
                        // ç»˜åˆ¶è¾¹æ¡†
                        ctx.strokeStyle = '#4a6baf';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(25, 70, width - 50, height - 120);
                        
                        // ç»˜åˆ¶åº•éƒ¨ä¿¡æ¯
                        ctx.fillStyle = '#999';
                        ctx.font = '12px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('ç”Ÿæˆæ—¶é—´: ' + new Date().toLocaleString(), width / 2, height - 30);
                        
                        canvas.toBlob(resolve, 'image/png');
                    }
                });
            }

            // ç®€å•çš„éšå†™æœ¯ - å°†æ–‡æœ¬åµŒå…¥å›¾ç‰‡
            function embedTextInImage(ctx, text) {
                const imageData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
                const data = imageData.data;
                
                // å°†æ–‡æœ¬è½¬æ¢ä¸ºäºŒè¿›åˆ¶
                const binaryText = text.split('').map(char => 
                    char.charCodeAt(0).toString(2).padStart(8, '0')
                ).join('');
                
                // åœ¨å›¾ç‰‡çš„æ¯ä¸ªåƒç´ çš„LSBä¸­åµŒå…¥æ•°æ®
                let bitIndex = 0;
                for (let i = 0; i < data.length; i += 4) {
                    if (bitIndex < binaryText.length) {
                        // ä¿®æ”¹RGBé€šé“çš„æœ€ä½æœ‰æ•ˆä½
                        for (let j = 0; j < 3; j++) {
                            if (bitIndex < binaryText.length) {
                                data[i + j] = (data[i + j] & 0xFE) | parseInt(binaryText[bitIndex]);
                                bitIndex++;
                            }
                        }
                    } else {
                        break;
                    }
                }
                
                ctx.putImageData(imageData, 0, 0);
            }

            // æ–‡æœ¬æ¢è¡Œå‡½æ•°
            function wrapText(context, text, x, y, maxWidth, lineHeight) {
                const words = text.split('');
                let line = '';
                let lines = [];
                
                for (let n = 0; n < words.length; n++) {
                    const testLine = line + words[n];
                    const metrics = context.measureText(testLine);
                    const testWidth = metrics.width;
                    
                    if (testWidth > maxWidth && n > 0) {
                        lines.push(line);
                        context.fillText(line, x, y);
                        line = words[n];
                        y += lineHeight;
                    } else {
                        line = testLine;
                    }
                }
                
                lines.push(line);
                context.fillText(line, x, y);
                return lines;
            }

            // æ˜¾ç¤ºGiteeé…ç½®æ¨¡æ€æ¡†
            function showGiteeConfig(blob) {
                // è¿™é‡Œæ¨¡æ‹Ÿç”ŸæˆGiteeå›¾ç‰‡URLï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ä¸Šä¼ åˆ°Gitee
                const giteeUrl = 'https://gitee.com/nnoonn1994/lianjiang/raw/master/tvbox-config.png';
                
                // ç”ŸæˆTVBOXé…ç½®
                const tvboxConfig = {
                    "url": giteeUrl,
                    "type": "image",
                    "encrypted": true
                };
                
                giteeImageUrl.value = giteeUrl;
                giteeTvboxConfig.value = JSON.stringify(tvboxConfig, null, 2);
                giteeModal.style.display = 'flex';
            }

            // ä¸‹è½½Blobæ–‡ä»¶
            function downloadBlob(blob, filename) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // å¤åˆ¶Canvasåˆ°å‰ªè´´æ¿
            async function copyCanvasToClipboard() {
                try {
                    const canvas = cryptoCanvas;
                    canvas.toBlob(async function(blob) {
                        try {
                            const item = new ClipboardItem({ 'image/png': blob });
                            await navigator.clipboard.write([item]);
                            alert('å›¾ç‰‡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                        } catch (err) {
                            console.error('å¤åˆ¶å¤±è´¥:', err);
                            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·ä½¿ç”¨ä¸‹è½½åŠŸèƒ½');
                        }
                    });
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·ä½¿ç”¨ä¸‹è½½åŠŸèƒ½');
                }
            }

            // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
            function showImagePreview(blob) {
                const url = URL.createObjectURL(blob);
                
                let previewContainer = document.getElementById('image-preview-container');
                if (!previewContainer) {
                    previewContainer = document.createElement('div');
                    previewContainer.id = 'image-preview-container';
                    previewContainer.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        padding: 20px;
                        border-radius: 8px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                        z-index: 1000;
                        max-width: 90%;
                        max-height: 90%;
                        overflow: auto;
                    `;
                    
                    document.body.appendChild(previewContainer);
                }
                
                previewContainer.innerHTML = `
                    <button onclick="document.body.removeChild(this.parentElement); URL.revokeObjectURL('${url}')" 
                            style="position: absolute; top: 10px; right: 10px; background: var(--danger-color); color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">
                        å…³é—­
                    </button>
                    <img src="${url}" style="max-width: 100%; height: auto; display: block;" alt="é…ç½®å›¾ç‰‡é¢„è§ˆ">
                `;
            }

            // å¢å¼ºå®¹é”™èƒ½åŠ›ï¼šæ•°æ®æ¸…æ´—å‡½æ•°
            function sanitizeConfig(config) {
                console.log('å¼€å§‹æ¸…æ´—é…ç½®æ•°æ®...');
                
                // ç¡®ä¿å¿…è¦çš„æ ¹çº§å­—æ®µå­˜åœ¨
                if (!config.sites) config.sites = [];
                if (!config.lives) config.lives = [];
                if (!config.parses) config.parses = [];
                if (!config.flags) config.flags = [];
                if (!config.categories) config.categories = [];
                if (!config.ijk) config.ijk = [];
                if (!config.ads) config.ads = [];
                
                // æ¸…æ´—ç«™ç‚¹æ•°æ®
                if (config.sites && Array.isArray(config.sites)) {
                    config.sites.forEach((site, index) => {
                        // ç¡®ä¿å¿…è¦çš„å­—æ®µå­˜åœ¨ä¸”æœ‰æœ‰æ•ˆå€¼
                        if (!site.key) site.key = `site_${index}`;
                        if (!site.name) site.name = `ç«™ç‚¹${index}`;
                        if (site.type === undefined || site.type === null) site.type = 1;
                        if (!site.api) site.api = '';
                        
                        // å¤„ç†æ•°å­—å­—æ®µï¼Œå°† undefined/null è½¬æ¢ä¸ºé»˜è®¤å€¼
                        // ä¿®æ”¹ï¼šå°†é»˜è®¤å€¼ä»1æ”¹ä¸º0
                        if (site.searchable === undefined || site.searchable === null || site.searchable === 'undefined') {
                            site.searchable = 0;
                        }
                        if (site.quickSearch === undefined || site.quickSearch === null || site.quickSearch === 'undefined') {
                            site.quickSearch = 0;
                        }
                        if (site.filterable === undefined || site.filterable === null || site.filterable === 'undefined') {
                            site.filterable = 0;
                        }
                        
                        // ç¡®ä¿æ•°å­—å­—æ®µæ˜¯æ•°å­—ç±»å‹
                        site.searchable = parseInt(site.searchable) || 0;
                        site.quickSearch = parseInt(site.quickSearch) || 0;
                        site.filterable = parseInt(site.filterable) || 0;
                        site.type = parseInt(site.type) || 1;
                        
                        // å¤„ç†å…¶ä»–å¯é€‰å­—æ®µ
                        if (!site.jar) site.jar = '';
                        if (!site.ext) site.ext = '';
                        if (!site.categories || !Array.isArray(site.categories)) {
                            site.categories = [];
                        }
                        
                        console.log(`ç«™ç‚¹ ${index} æ¸…æ´—å®Œæˆ:`, {
                            key: site.key,
                            searchable: site.searchable,
                            quickSearch: site.quickSearch,
                            filterable: site.filterable
                        });
                    });
                }
                
                // æ¸…æ´—å…¶ä»–æ•°ç»„æ•°æ®
                ['lives', 'parses', 'flags', 'categories', 'ads'].forEach(key => {
                    if (!Array.isArray(config[key])) {
                        config[key] = [];
                    }
                });
                
                // æ¸…æ´—å­—ç¬¦ä¸²å­—æ®µ
                if (typeof config.spider !== 'string') config.spider = '';
                if (typeof config.wallpaper !== 'string') config.wallpaper = '';
                
                console.log('é…ç½®æ•°æ®æ¸…æ´—å®Œæˆ');
                return config;
            }

            // æ”¹è¿›çš„JSONè§£æå‡½æ•°ï¼Œå¤„ç†åµŒå¥—JSONå­—ç¬¦ä¸² - ä¿®å¤extå­—æ®µè§£æé—®é¢˜
            function parseComplexJsonString(text) {
                const siteData = {};
                
                // é¦–å…ˆæå–extå­—æ®µï¼Œé˜²æ­¢å…¶å†…å®¹è¢«é”™è¯¯è§£æä¸ºè‡ªå®šä¹‰å­—æ®µ
                const extMatch = text.match(/"ext":\s*("(?:[^"\\]|\\.)*"|\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\})/);
                if (extMatch) {
                    let extValue = extMatch[1];
                    // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå»é™¤å¼•å·
                    if (extValue.startsWith('"') && extValue.endsWith('"')) {
                        extValue = extValue.slice(1, -1);
                    }
                    siteData['ext'] = extValue;
                    
                    // ä»åŸå§‹æ–‡æœ¬ä¸­ç§»é™¤extå­—æ®µï¼Œé˜²æ­¢è¢«åç»­æ­£åˆ™åŒ¹é…
                    text = text.replace(extMatch[0], '');
                }
                
                // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é”®å€¼å¯¹ï¼Œä½†æ’é™¤extå­—æ®µå†…éƒ¨çš„åµŒå¥—JSON
                const keyValueRegex = /"([^"]+)":\s*("(?:[^"\\]|\\.)*"|\d+|true|false|null|\[[^\]]*\]|\{[^{}]*\}(?:\{[^{}]*\})*)/g;
                
                let match;
                while ((match = keyValueRegex.exec(text)) !== null) {
                    const key = match[1];
                    let value = match[2];
                    
                    // è·³è¿‡extå­—æ®µçš„ç‰¹æ®Šå¤„ç†
                    if (key === 'ext') {
                        continue;
                    }
                    
                    // å¤„ç†å­—ç¬¦ä¸²å€¼
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.slice(1, -1);
                    }
                    // å¤„ç†æ•°å­—å€¼
                    else if (!isNaN(value)) {
                        value = Number(value);
                    }
                    // å¤„ç†å¸ƒå°”å€¼
                    else if (value === 'true') {
                        value = true;
                    }
                    else if (value === 'false') {
                        value = false;
                    }
                    // å¤„ç†null
                    else if (value === 'null') {
                        value = null;
                    }
                    // å¤„ç†æ•°ç»„
                    else if (value.startsWith('[') && value.endsWith(']')) {
                        try {
                            value = JSON.parse(value);
                        } catch (e) {
                            // å¦‚æœè§£æå¤±è´¥ï¼Œä¿æŒåŸæ ·
                        }
                    }
                    // å¤„ç†ç®€å•å¯¹è±¡
                    else if (value.startsWith('{') && value.endsWith('}')) {
                        try {
                            value = JSON.parse(value);
                        } catch (e) {
                            // å¦‚æœè§£æå¤±è´¥ï¼Œä¿æŒåŸæ ·
                        }
                    }
                    
                    siteData[key] = value;
                }
                
                return siteData;
            }

            // å¿«é€ŸåŒ¹é…ä¿¡æ¯åŠŸèƒ½
            function initQuickMatch() {
                // åˆ‡æ¢å±•å¼€/æ”¶ç¼©çŠ¶æ€
                quickMatchHeader.addEventListener('click', function() {
                    const isExpanded = quickMatchContent.classList.contains('expanded');
                    
                    if (isExpanded) {
                        quickMatchContent.classList.remove('expanded');
                        quickMatchHeader.classList.remove('expanded');
                    } else {
                        quickMatchContent.classList.add('expanded');
                        quickMatchHeader.classList.add('expanded');
                    }
                });
                
                // å¤„ç†å¿«é€ŸåŒ¹é…æŒ‰é’®ç‚¹å‡»
                quickMatchBtn.addEventListener('click', function() {
                    const text = quickMatchTextarea.value.trim();
                    
                    if (!text) {
                        alert('è¯·è¾“å…¥ç‚¹æ’­æºé…ç½®ä¿¡æ¯');
                        return;
                    }
                    
                    try {
                        let siteData = {};
                        
                        // å°è¯•å¤šç§JSONæ ¼å¼è§£æ
                        try {
                            // é¦–å…ˆå°è¯•ç›´æ¥è§£æä¸ºJSONå¯¹è±¡
                            siteData = JSON.parse(text);
                        } catch (e1) {
                            try {
                                // å°è¯•è§£æä¸ºæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå¯¹è±¡
                                const arr = JSON.parse(text);
                                if (Array.isArray(arr) && arr.length > 0) {
                                    siteData = arr[0];
                                } else {
                                    throw new Error('ä¸æ˜¯æœ‰æ•ˆçš„ç‚¹æ’­æºé…ç½®');
                                }
                            } catch (e2) {
                                try {
                                    // å°è¯•ä»sitesæ•°ç»„ä¸­æå–
                                    const fullConfig = JSON.parse(text);
                                    if (fullConfig.sites && Array.isArray(fullConfig.sites) && fullConfig.sites.length > 0) {
                                        siteData = fullConfig.sites[0];
                                    } else {
                                        throw new Error('é…ç½®ä¸­æœªæ‰¾åˆ°ç‚¹æ’­æºä¿¡æ¯');
                                    }
                                } catch (e3) {
                                    // æœ€åå°è¯•ï¼šä½¿ç”¨æ”¹è¿›çš„é”®å€¼å¯¹æå–æ–¹æ³•ï¼Œå¤„ç†åµŒå¥—JSON
                                    siteData = parseComplexJsonString(text);
                                }
                            }
                        }
                        
                        // æ£€æŸ¥å½“å‰æ˜¯å¦å¤„äºç¼–è¾‘æ¨¡å¼
                        const isEditing = editingIndex !== -1;
                        
                        // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œåªæ›´æ–°åŒ¹é…çš„å­—æ®µï¼Œä¸æ¸…ç©ºè¡¨å•
                        if (isEditing) {
                            // åªæ›´æ–°åŒ¹é…åˆ°çš„å­—æ®µï¼Œä¿ç•™å…¶ä»–å­—æ®µä¸å˜
                            if (siteData.key) document.getElementById('vod-key').value = siteData.key;
                            if (siteData.name) document.getElementById('vod-name').value = siteData.name;
                            if (siteData.type !== undefined) document.getElementById('vod-type').value = siteData.type;
                            if (siteData.api) document.getElementById('vod-api').value = siteData.api;
                            if (siteData.jar) vodJarInput.value = siteData.jar;
                            
                            // ä¿®æ”¹ï¼šå½“å­—æ®µä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨0ä½œä¸ºé»˜è®¤å€¼
                            if (siteData.searchable !== undefined) {
                                document.getElementById('vod-searchable').value = siteData.searchable;
                            }
                            
                            if (siteData.quickSearch !== undefined) {
                                document.getElementById('vod-quickSearch').value = siteData.quickSearch;
                            }
                            
                            if (siteData.filterable !== undefined) {
                                document.getElementById('vod-filterable').value = siteData.filterable;
                            }
                            
                            // ç‰¹æ®Šå¤„ç†extå­—æ®µ - ä¿æŒå…¶åŸå§‹JSONå­—ç¬¦ä¸²æ ¼å¼
                            if (siteData.ext) {
                                if (typeof siteData.ext === 'string') {
                                    vodExtInput.value = siteData.ext;
                                } else {
                                    // å¦‚æœextæ˜¯å¯¹è±¡ï¼Œåˆ™è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
                                    vodExtInput.value = JSON.stringify(siteData.ext);
                                }
                            }
                            
                            // æ›´æ–°åˆ†ç±»ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                            if (siteData.categories && Array.isArray(siteData.categories)) {
                                config.categories = [...siteData.categories];
                                loadCategories();
                            }
                            
                            // æ›´æ–°è‡ªå®šä¹‰å­—æ®µï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                            const standardFields = ['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'];
                            
                            for (const key in siteData) {
                                if (!standardFields.includes(key)) {
                                    // æŸ¥æ‰¾æ˜¯å¦å·²å­˜åœ¨è¯¥è‡ªå®šä¹‰å­—æ®µ
                                    let existingField = null;
                                    Object.keys(customFields).forEach(fieldId => {
                                        if (customFields[fieldId].name === key) {
                                            existingField = fieldId;
                                        }
                                    });
                                    
                                    if (existingField) {
                                        // æ›´æ–°ç°æœ‰å­—æ®µ
                                        const fieldItem = document.querySelector(`.custom-field-item[data-id="${existingField}"]`);
                                        if (fieldItem) {
                                            const valueInput = fieldItem.querySelector('.custom-field-value');
                                            // ç›´æ¥è®¾ç½®å€¼ï¼Œä¸å…³å¿ƒç±»å‹
                                            if (typeof siteData[key] === 'object') {
                                                valueInput.value = JSON.stringify(siteData[key]);
                                            } else {
                                                valueInput.value = siteData[key];
                                            }
                                            
                                            // æ›´æ–°customFieldså¯¹è±¡
                                            customFields[existingField].value = valueInput.value;
                                        }
                                    } else {
                                        // æ·»åŠ æ–°å­—æ®µ
                                        const fieldId = 'custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                        const fieldItem = document.createElement('div');
                                        fieldItem.className = 'custom-field-item';
                                        fieldItem.dataset.id = fieldId;
                                        
                                        // ç›´æ¥è®¾ç½®å€¼ï¼Œä¸å…³å¿ƒç±»å‹
                                        let fieldValue = siteData[key];
                                        if (typeof fieldValue === 'object') {
                                            fieldValue = JSON.stringify(fieldValue);
                                        }
                                        
                                        fieldItem.innerHTML = `
                                            <input type="text" class="custom-field-name" placeholder="å­—æ®µå" value="${key}">
                                            <input type="text" class="custom-field-value" placeholder="å­—æ®µå€¼" value="${fieldValue}">
                                            <button class="button-cancel remove-custom-field">åˆ é™¤</button>
                                        `;
                                        
                                        customFieldsContainer.appendChild(fieldItem);
                                        
                                        // æ·»åŠ åˆ é™¤äº‹ä»¶
                                        fieldItem.querySelector('.remove-custom-field').addEventListener('click', function() {
                                            fieldItem.remove();
                                            delete customFields[fieldId];
                                            updateConfigJson();
                                        });
                                        
                                        // æ·»åŠ è¾“å…¥äº‹ä»¶
                                        const nameInput = fieldItem.querySelector('.custom-field-name');
                                        const valueInput = fieldItem.querySelector('.custom-field-value');
                                        
                                        const updateCustomField = function() {
                                            if (nameInput.value.trim() && valueInput.value.trim()) {
                                                customFields[fieldId] = {
                                                    name: nameInput.value.trim(),
                                                    value: valueInput.value.trim()
                                                };
                                            } else {
                                                delete customFields[fieldId];
                                            }
                                            updateConfigJson();
                                        };
                                        
                                        nameInput.addEventListener('input', updateCustomField);
                                        valueInput.addEventListener('input', updateCustomField);
                                        
                                        // æ·»åŠ åˆ°customFieldså¯¹è±¡
                                        customFields[fieldId] = {
                                            name: key,
                                            value: fieldValue
                                        };
                                    }
                                }
                            }
                            
                            alert('é…ç½®ä¿¡æ¯å·²æˆåŠŸåŒæ­¥åˆ°ç¼–è¾‘è¡¨å•ä¸­ï¼');
                        } else {
                            // éç¼–è¾‘æ¨¡å¼ï¼Œæ¸…ç©ºè¡¨å•å¹¶å¡«å……æ–°æ•°æ®
                            clearVodForm();
                            
                            // å¡«å……è¡¨å•å­—æ®µ
                            if (siteData.key) document.getElementById('vod-key').value = siteData.key;
                            if (siteData.name) document.getElementById('vod-name').value = siteData.name;
                            if (siteData.type !== undefined) document.getElementById('vod-type').value = siteData.type;
                            if (siteData.api) document.getElementById('vod-api').value = siteData.api;
                            if (siteData.jar) vodJarInput.value = siteData.jar;
                            
                            // ä¿®æ”¹ï¼šå½“å­—æ®µä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨0ä½œä¸ºé»˜è®¤å€¼
                            if (siteData.searchable !== undefined) {
                                document.getElementById('vod-searchable').value = siteData.searchable;
                            } else {
                                document.getElementById('vod-searchable').value = 0; // é»˜è®¤å€¼ä¸º0
                            }
                            
                            if (siteData.quickSearch !== undefined) {
                                document.getElementById('vod-quickSearch').value = siteData.quickSearch;
                            } else {
                                document.getElementById('vod-quickSearch').value = 0; // é»˜è®¤å€¼ä¸º0
                            }
                            
                            if (siteData.filterable !== undefined) {
                                document.getElementById('vod-filterable').value = siteData.filterable;
                            } else {
                                document.getElementById('vod-filterable').value = 0; // é»˜è®¤å€¼ä¸º0
                            }
                            
                            // ç‰¹æ®Šå¤„ç†extå­—æ®µ - ä¿æŒå…¶åŸå§‹JSONå­—ç¬¦ä¸²æ ¼å¼
                            if (siteData.ext) {
                                if (typeof siteData.ext === 'string') {
                                    vodExtInput.value = siteData.ext;
                                } else {
                                    // å¦‚æœextæ˜¯å¯¹è±¡ï¼Œåˆ™è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
                                    vodExtInput.value = JSON.stringify(siteData.ext);
                                }
                            }
                            
                            // æ›´æ–°åˆ†ç±»
                            if (siteData.categories && Array.isArray(siteData.categories)) {
                                config.categories = [...siteData.categories];
                                loadCategories();
                            } else {
                                config.categories = [];
                                loadCategories();
                            }
                            
                            // æ¸…ç©ºå¹¶é‡æ–°æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
                            customFieldsContainer.innerHTML = '';
                            customFields = {};
                            
                            // è·å–è‡ªå®šä¹‰å­—æ®µï¼ˆæ’é™¤æ ‡å‡†å­—æ®µï¼‰
                            const standardFields = ['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'];
                            
                            for (const key in siteData) {
                                if (!standardFields.includes(key)) {
                                    const fieldId = 'custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                    const fieldItem = document.createElement('div');
                                    fieldItem.className = 'custom-field-item';
                                    fieldItem.dataset.id = fieldId;
                                    
                                    // ç›´æ¥è®¾ç½®å€¼ï¼Œä¸å…³å¿ƒç±»å‹
                                    let fieldValue = siteData[key];
                                    if (typeof fieldValue === 'object') {
                                        fieldValue = JSON.stringify(fieldValue);
                                    }
                                    
                                    fieldItem.innerHTML = `
                                        <input type="text" class="custom-field-name" placeholder="å­—æ®µå" value="${key}">
                                        <input type="text" class="custom-field-value" placeholder="å­—æ®µå€¼" value="${fieldValue}">
                                        <button class="button-cancel remove-custom-field">åˆ é™¤</button>
                                    `;
                                    
                                    customFieldsContainer.appendChild(fieldItem);
                                    
                                    // æ·»åŠ åˆ é™¤äº‹ä»¶
                                    fieldItem.querySelector('.remove-custom-field').addEventListener('click', function() {
                                        fieldItem.remove();
                                        delete customFields[fieldId];
                                        updateConfigJson();
                                    });
                                    
                                    // æ·»åŠ è¾“å…¥äº‹ä»¶
                                    const nameInput = fieldItem.querySelector('.custom-field-name');
                                    const valueInput = fieldItem.querySelector('.custom-field-value');
                                    
                                    const updateCustomField = function() {
                                        if (nameInput.value.trim() && valueInput.value.trim()) {
                                            customFields[fieldId] = {
                                                name: nameInput.value.trim(),
                                                value: valueInput.value.trim()
                                            };
                                        } else {
                                            delete customFields[fieldId];
                                        }
                                        updateConfigJson();
                                        };
                                        
                                        nameInput.addEventListener('input', updateCustomField);
                                        valueInput.addEventListener('input', updateCustomField);
                                        
                                        // æ·»åŠ åˆ°customFieldså¯¹è±¡
                                        customFields[fieldId] = {
                                            name: key,
                                            value: fieldValue
                                        };
                                }
                            }
                            
                            alert('é…ç½®ä¿¡æ¯å·²æˆåŠŸåŒæ­¥åˆ°è¡¨å•ä¸­ï¼');
                        }
                        
                        // æ›´æ–°é…ç½®JSON
                        updateConfigJson();
                        
                        // æ¸…ç©ºæ–‡æœ¬æ¡†å†…å®¹
                        quickMatchTextarea.value = '';
                        
                        // æ”¶ç¼©å¿«é€ŸåŒ¹é…åŒºåŸŸ
                        quickMatchContent.classList.remove('expanded');
                        quickMatchHeader.classList.remove('expanded');
                        
                    } catch (error) {
                        console.error('è§£æé…ç½®å¤±è´¥:', error);
                        alert('è§£æé…ç½®å¤±è´¥: ' + error.message);
                    }
                });
                
                // æ¸…é™¤æŒ‰é’®åŠŸèƒ½
                quickMatchClearBtn.addEventListener('click', function() {
                    quickMatchTextarea.value = '';
                });
            }

            // åˆå§‹åŒ–å¿«é€ŸåŒ¹é…åŠŸèƒ½
            initQuickMatch();

            // æ–°å¢ï¼šç‚¹æ’­æºå¯¼èˆªæ æ‹–æ‹½åŠŸèƒ½
            function initVodNavigationDrag() {
                // ä¸ºå¯¼èˆªæŒ‰é’®æ·»åŠ æ‹–æ‹½äº‹ä»¶
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.addEventListener('dragstart', handleNavDragStart);
                    btn.addEventListener('dragover', handleNavDragOver);
                    btn.addEventListener('dragleave', handleNavDragLeave);
                    btn.addEventListener('drop', handleNavDrop);
                    btn.addEventListener('dragend', handleNavDragEnd);
                });
            }

            // å¯¼èˆªæŒ‰é’®æ‹–æ‹½å¼€å§‹
            function handleNavDragStart(e) {
                draggedNavBtn = this;
                dragStartNavIndex = parseInt(this.dataset.index);
                
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.outerHTML);
                
                // è®¾ç½®æ‹–æ‹½å›¾åƒä¸ºæŒ‰é’®æœ¬èº«
                e.dataTransfer.setDragImage(this, 20, 20);
            }

            // å¯¼èˆªæŒ‰é’®æ‹–æ‹½ç»è¿‡
            function handleNavDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const targetBtn = e.target.closest('.vod-nav-btn');
                if (targetBtn && targetBtn !== draggedNavBtn) {
                    targetBtn.classList.add('drag-over');
                }
            }

            // å¯¼èˆªæŒ‰é’®æ‹–æ‹½ç¦»å¼€
            function handleNavDragLeave(e) {
                const targetBtn = e.target.closest('.vod-nav-btn');
                if (targetBtn) {
                    targetBtn.classList.remove('drag-over');
                }
            }

            // å¯¼èˆªæŒ‰é’®æ‹–æ‹½æ”¾ç½®
            function handleNavDrop(e) {
                e.preventDefault();
                
                const targetBtn = e.target.closest('.vod-nav-btn');
                if (!targetBtn || targetBtn === draggedNavBtn) {
                    // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„drag-overç±»
                    document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                        btn.classList.remove('drag-over');
                    });
                    return;
                }
                
                const dragEndNavIndex = parseInt(targetBtn.dataset.index);
                
                if (dragStartNavIndex !== dragEndNavIndex) {
                    // ä»åŸä½ç½®ç§»é™¤æ‹–åŠ¨çš„é¡¹ç›®
                    const [movedItem] = config.sites.splice(dragStartNavIndex, 1);
                    
                    // æ’å…¥åˆ°æ–°ä½ç½®
                    config.sites.splice(dragEndNavIndex, 0, movedItem);
                    
                    // ç«‹å³æ›´æ–°UI
                    loadVodItems();
                    updateVodNavigation();
                    updateConfigJson();
                }
                
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„drag-overç±»
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('drag-over');
                });
            }

            // å¯¼èˆªæŒ‰é’®æ‹–æ‹½ç»“æŸ - ä¿®å¤ä½ç½®åç§»é—®é¢˜
            function handleNavDragEnd(e) {
                if (draggedNavBtn) {
                    draggedNavBtn.classList.remove('dragging');
                    // ç¡®ä¿æŒ‰é’®å›åˆ°åŸå§‹ä½ç½®
                    draggedNavBtn.style.transform = '';
                    draggedNavBtn = null;
                }
                
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„drag-overç±»
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('drag-over');
                });
            }

            // æ–°å¢ï¼šæ›´æ–°ç‚¹æ’­æºå¯¼èˆªæ  - ä¿®æ”¹ï¼šé™åˆ¶æŒ‰é’®æ–‡å­—é•¿åº¦ä¸º5ä¸ªå­—ç¬¦
            function updateVodNavigation() {
                vodNavButtons.innerHTML = '';
                
                if (config.sites.length === 0) {
                    vodNavigation.style.display = 'none';
                    return;
                }
                
                vodNavigation.style.display = 'block';
                
                config.sites.forEach((site, index) => {
                    const navBtn = document.createElement('button');
                    navBtn.className = 'vod-nav-btn';
                    navBtn.dataset.index = index;
                    
                    // ä¿®æ”¹ï¼šé™åˆ¶æŒ‰é’®æ–‡å­—é•¿åº¦ï¼Œè¶…è¿‡5ä¸ªå­—ç¬¦æ˜¾ç¤ºçœç•¥å·
                    let displayName = site.name;
                    if (displayName.length > 5) {
                        displayName = displayName.substring(0, 5) + 'â€¦';
                    }
                    navBtn.textContent = displayName;
                    navBtn.title = site.name; // æ·»åŠ å®Œæ•´åç§°ä½œä¸ºæç¤º
                    
                    navBtn.draggable = true;
                    
                    navBtn.addEventListener('click', function() {
                        // æ»šåŠ¨åˆ°å¯¹åº”çš„ç‚¹æ’­æºé¡¹ç›®
                        const targetItem = document.querySelector(`.source-item[data-index="${index}"]`);
                        if (targetItem) {
                            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
                            document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            
                            // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                            this.classList.add('active');
                            
                            // æ»šåŠ¨åˆ°ç›®æ ‡å…ƒç´ 
                            targetItem.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });
                            
                            // æ·»åŠ é«˜äº®æ•ˆæœ
                            targetItem.style.boxShadow = '0 0 0 2px var(--primary-color)';
                            setTimeout(() => {
                                targetItem.style.boxShadow = '';
                            }, 2000);
                        }
                    });
                    
                    vodNavButtons.appendChild(navBtn);
                });
                
                // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
                initVodNavigationDrag();
            }

            // æ–°å¢ï¼šé«˜äº®å¯¼èˆªæŒ‰é’®
            function highlightNavButton(index) {
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                const targetBtn = document.querySelector(`.vod-nav-btn[data-index="${index}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }
            }

            // JSONæ˜¾ç¤º/éšè—åˆ‡æ¢ - ä¿®æ”¹åçš„ç‰ˆæœ¬
            let isJsonVisible = false;
            toggleJsonBtn.addEventListener('click', function() {
                const buttonPosition = this.getBoundingClientRect().top + window.pageYOffset;
                
                isJsonVisible = !isJsonVisible;
                if (isJsonVisible) {
                    configJson.classList.remove('hidden');
                    this.textContent = 'éšè—JSON';
                    // æ»šåŠ¨åˆ°åº•éƒ¨æ˜¾ç¤ºä»£ç æ å…¨è²Œ
                    setTimeout(() => {
                        window.scrollTo({
                            top: document.body.scrollHeight,
                            behavior: 'smooth'
                        });
                    }, 50);
                } else {
                    configJson.classList.add('hidden');
                    this.textContent = 'æ˜¾ç¤ºJSON';
                    // æ»šåŠ¨å›æŒ‰é’®ä½ç½®æ˜¾ç¤ºæŒ‰é’®å…¨è²Œ
                    setTimeout(() => {
                        window.scrollTo({
                            top: buttonPosition - 20, // å‡å»20pxè®©æŒ‰é’®ä¸Šæ–¹æœ‰ç‚¹ç©ºé—´
                            behavior: 'smooth'
                        });
                    }, 50);
                }
            });

            // ä¸Šä¼ JSONæ–‡ä»¶ - å¢å¼ºå®¹é”™ç‰ˆæœ¬ - æ–°å¢spideræå–åŠŸèƒ½ - æ–°å¢wallpaperæå–åŠŸèƒ½ - æ–°å¢å…¨é…ç½®åŒæ­¥åŠŸèƒ½
            uploadJsonBtn.addEventListener('click', function() {
                uploadJsonInput.click();
            });

            uploadJsonInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        let uploadedConfig;
                        try {
                            uploadedConfig = JSON.parse(e.target.result);
                        } catch (parseError) {
                            // å°è¯•ä¿®å¤å¸¸è§çš„JSONæ ¼å¼é”™è¯¯
                            console.log('JSONè§£æå¤±è´¥ï¼Œå°è¯•ä¿®å¤...', parseError);
                            const fixedJson = e.target.result
                                .replace(/"filterable": undefined/g, '"filterable": 0')
                                .replace(/"searchable": undefined/g, '"searchable": 0')
                                .replace(/"quickSearch": undefined/g, '"quickSearch": 0')
                                .replace(/"type": undefined/g, '"type": 1');
                            
                            uploadedConfig = JSON.parse(fixedJson);
                            console.log('JSONä¿®å¤æˆåŠŸ');
                        }
                        
                        // éªŒè¯ä¸Šä¼ çš„JSONæ˜¯å¦åŒ…å«å¿…è¦çš„ç»“æ„
                        if (!uploadedConfig.sites || !Array.isArray(uploadedConfig.sites)) {
                            // å¦‚æœsitesä¸å­˜åœ¨ï¼Œå°è¯•ä»å…¶ä»–å¯èƒ½çš„å­—æ®µåè·å–
                            if (uploadedConfig.vodSites && Array.isArray(uploadedConfig.vodSites)) {
                                uploadedConfig.sites = uploadedConfig.vodSites;
                            } else {
                                throw new Error('ä¸Šä¼ çš„JSONæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘sitesæ•°ç»„');
                            }
                        }

                        // æ•°æ®æ¸…æ´—
                        uploadedConfig = sanitizeConfig(uploadedConfig);

                        // ä¿ç•™åŸæœ‰çš„éç‚¹æ’­æºé…ç½®ï¼Œä½†ç”¨ä¸Šä¼ çš„é…ç½®è¦†ç›–ç›¸åŒå­—æ®µ
                        const newConfig = {
                            ...config,
                            ...uploadedConfig,
                            // ç¡®ä¿æ•°ç»„ä¸è¢«å®Œå…¨è¦†ç›–ï¼Œè€Œæ˜¯åˆå¹¶æˆ–æ›¿æ¢
                            sites: uploadedConfig.sites,
                            // ä¿®æ”¹ï¼šä¸ä¿ç•™ä¸Šä¼ çš„åˆ†ç±»é…ç½®ï¼Œä¿æŒé»˜è®¤ç©ºæ•°ç»„
                            categories: []
                        };

                        // æ›´æ–°å…¨å±€é…ç½®
                        config = newConfig;
                        
                        // æ–°å¢ï¼šå¦‚æœä¸Šä¼ çš„JSONä¸­æœ‰spiderä¿¡æ¯ï¼ŒåŒæ­¥åˆ°spideræ ä¸­
                        if (uploadedConfig.spider && uploadedConfig.spider.trim() !== '') {
                            globalSpiderInput.value = uploadedConfig.spider;
                        }
                        
                        // æ–°å¢ï¼šå¦‚æœä¸Šä¼ çš„JSONä¸­æœ‰wallpaperä¿¡æ¯ï¼ŒåŒæ­¥åˆ°å£çº¸URLæ ä¸­
                        if (uploadedConfig.wallpaper && uploadedConfig.wallpaper.trim() !== '') {
                            wallpaperUrlInput.value = uploadedConfig.wallpaper;
                        }
                        
                        // æ–°å¢ï¼šåŒæ­¥ç›´æ’­æºé…ç½®
                        if (uploadedConfig.lives && Array.isArray(uploadedConfig.lives)) {
                            config.lives = uploadedConfig.lives;
                            loadLiveChannels();
                        }
                        
                        // æ–°å¢ï¼šåŒæ­¥è§£æåœ°å€é…ç½®
                        if (uploadedConfig.parses && Array.isArray(uploadedConfig.parses)) {
                            config.parses = uploadedConfig.parses;
                            loadParses();
                        }
                        
                        // æ–°å¢ï¼šåŒæ­¥VIPè§£ææ ‡è¯†
                        if (uploadedConfig.flags && Array.isArray(uploadedConfig.flags)) {
                            config.flags = uploadedConfig.flags;
                            vipFlagsInput.value = uploadedConfig.flags.join(',');
                        }
                        
                        // æ–°å¢ï¼šåŒæ­¥IJKè§£ç é…ç½®
                        if (uploadedConfig.ijk && Array.isArray(uploadedConfig.ijk)) {
                            config.ijk = uploadedConfig.ijk;
                            updateIjkOptionsTextarea();
                            loadIjkOptions();
                        }
                        
                        // æ–°å¢ï¼šåŒæ­¥å¹¿å‘Šè¿‡æ»¤é…ç½®
                        if (uploadedConfig.ads && Array.isArray(uploadedConfig.ads)) {
                            config.ads = uploadedConfig.ads;
                            adDomainsTextarea.value = uploadedConfig.ads.join('\n');
                        }
                        
                        // æ›´æ–°UI
                        updateConfigJson();
                        loadVodItems();
                        loadCategories(); // è¿™ä¼šæ¸…ç©ºåˆ†ç±»æ˜¾ç¤º
                        updateVodNavigation(); // æ–°å¢ï¼šæ›´æ–°å¯¼èˆªæ 
                        
                        let successMessage = 'æˆåŠŸå¯¼å…¥' + uploadedConfig.sites.length + 'ä¸ªç‚¹æ’­æºé…ç½®ï¼';
                        if (uploadedConfig.spider) {
                            successMessage += ' Spiderä¿¡æ¯å·²åŒæ­¥ã€‚';
                        }
                        if (uploadedConfig.wallpaper) {
                            successMessage += ' å£çº¸ä¿¡æ¯å·²åŒæ­¥ã€‚';
                        }
                        if (uploadedConfig.lives) {
                            successMessage += ' ç›´æ’­æºå·²åŒæ­¥ã€‚';
                        }
                        if (uploadedConfig.parses) {
                            successMessage += ' è§£æåœ°å€å·²åŒæ­¥ã€‚';
                        }
                        if (uploadedConfig.flags) {
                            successMessage += ' VIPæ ‡è¯†å·²åŒæ­¥ã€‚';
                        }
                        if (uploadedConfig.ijk) {
                            successMessage += ' IJKé…ç½®å·²åŒæ­¥ã€‚';
                        }
                        if (uploadedConfig.ads) {
                            successMessage += ' å¹¿å‘Šè¿‡æ»¤å·²åŒæ­¥ã€‚';
                        }
                        alert(successMessage);
                    } catch (err) {
                        console.error('å¯¼å…¥å¤±è´¥:', err);
                        alert('å¯¼å…¥å¤±è´¥: ' + err.message + '\n\nè¯·æ£€æŸ¥JSONæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚');
                    }
                };
                
                reader.onerror = function() {
                    alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
                };
                
                reader.readAsText(file);
            });

            // æ·»åŠ è‡ªå®šä¹‰å­—æ®µ - ç®€åŒ–ç‰ˆæœ¬ï¼Œåªä¿ç•™å­—æ®µåå’Œå€¼
            addCustomFieldBtn.addEventListener('click', function() {
                const fieldId = 'custom-field-' + Date.now();
                const fieldItem = document.createElement('div');
                fieldItem.className = 'custom-field-item';
                fieldItem.dataset.id = fieldId;
                
                fieldItem.innerHTML = `
                    <input type="text" class="custom-field-name" placeholder="å­—æ®µå">
                    <input type="text" class="custom-field-value" placeholder="å­—æ®µå€¼">
                    <button class="button-cancel remove-custom-field">åˆ é™¤</button>
                `;
                
                customFieldsContainer.appendChild(fieldItem);
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                fieldItem.querySelector('.remove-custom-field').addEventListener('click', function() {
                    fieldItem.remove();
                    delete customFields[fieldId];
                    updateConfigJson();
                });
                
                // æ·»åŠ è¾“å…¥äº‹ä»¶
                const nameInput = fieldItem.querySelector('.custom-field-name');
                const valueInput = fieldItem.querySelector('.custom-field-value');
                
                const updateCustomField = function() {
                    if (nameInput.value.trim() && valueInput.value.trim()) {
                        customFields[fieldId] = {
                            name: nameInput.value.trim(),
                            value: valueInput.value.trim()
                        };
                    } else {
                        delete customFields[fieldId];
                    }
                    updateConfigJson();
                };
                
                nameInput.addEventListener('input', updateCustomField);
                valueInput.addEventListener('input', updateCustomField);
            });

            // æ ‡ç­¾é¡µåˆ‡æ¢
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.config-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(`${tab}-config`).classList.add('active');
                });
            });

            // åŠ è§£å¯†å·¥å…·åˆå§‹åŒ–
            function initCrypto() {
                // åˆå§‹åŒ–IVä¸ºå½“å‰æ—¶é—´æˆ³
                cryptoIvInput.value = new Date().getTime();
                
                // æ ¹æ®æ“ä½œç±»å‹æ˜¾ç¤º/éšè—Base64é€‰é¡¹
                function toggleBase64Option() {
                    if (cryptoOperationSelect.value === 'decrypt') {
                        cryptoBase64Group.classList.remove('hidden');
                    } else {
                        cryptoBase64Group.classList.add('hidden');
                        cryptoBase64Check.checked = false;
                    }
                }
                
                // åˆå§‹åŒ–æ˜¾ç¤ºçŠ¶æ€
                toggleBase64Option();
                
                // ç›‘å¬æ“ä½œç±»å‹å˜åŒ–
                cryptoOperationSelect.addEventListener('change', toggleBase64Option);
                
                // å¤„ç†æŒ‰é’®äº‹ä»¶
                cryptoProcessBtn.addEventListener('click', processCryptoData);
                
                // å¤åˆ¶æŒ‰é’®äº‹ä»¶
                cryptoCopyBtn.addEventListener('click', copyCryptoResult);
                
                // æ¸…é™¤æŒ‰é’®äº‹ä»¶
                cryptoClearBtn.addEventListener('click', clearCryptoFields);
                
                // ä¸Šä¼ æ–‡ä»¶æŒ‰é’®äº‹ä»¶
                cryptoUploadBtn.addEventListener('click', function() {
                    cryptoFileInput.click();
                });
                
                // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
                cryptoFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        cryptoInput.value = e.target.result;
                    };
                    reader.readAsText(file);
                });
                
                function clearCryptoFields() {
                    cryptoInput.value = '';
                    cryptoOutput.value = '';
                    cryptoBase64Check.checked = false;
                }
                
                function padTo16Byte(str) {
                    return CryptoJS.enc.Utf8.parse(str.toString().padEnd(16, '0'));
                }
                
                function Encrypt(word, keyStr, ivStr) {
                    const key = padTo16Byte(keyStr);
                    const iv = padTo16Byte(ivStr);
                    const encrypted = CryptoJS.AES.encrypt(word, key, { iv });
                    return encrypted.ciphertext.toString(CryptoJS.enc.Hex);
                }
                
                function Decrypt(word, keyStr, ivStr) {
                    const key = padTo16Byte(keyStr);
                    const iv = padTo16Byte(ivStr);
                    const ciphertext = CryptoJS.enc.Hex.parse(word);
                    const decrypt = CryptoJS.AES.decrypt({ ciphertext }, key, { iv });
                    return decrypt.toString(CryptoJS.enc.Utf8);
                }
                
                function decryptAesBCB(encryptedData) {
                    var dataArr = encryptedData.split("");
                    var prefixCode = CryptoJS.enc.Utf8.parse("$#").toString();
                    var suffixCode = CryptoJS.enc.Utf8.parse("#$").toString();
                    var pwdMix = dataArr
                      .splice(0, encryptedData.indexOf(suffixCode) + 4)
                      .join("");
                    var roundtimeInHax = dataArr.splice(dataArr.length - 26, 26).join("");
                    var encryptedText = dataArr.join("");
                    var pwdInHax = pwdMix.substring(
                      prefixCode.length,
                      pwdMix.length - suffixCode.length
                    );
                    var roundTime = CryptoJS.enc.Utf8.stringify(
                      CryptoJS.enc.Hex.parse(roundtimeInHax)
                    );
                    var pwd = CryptoJS.enc.Utf8.stringify(CryptoJS.enc.Hex.parse(pwdInHax));
                    var iv = CryptoJS.enc.Utf8.parse(roundTime.padEnd(16, "0"));
                    var pkBlocks = CryptoJS.enc.Utf8.parse(pwd.padEnd(16, "0"));
                    var cipherParams = CryptoJS.lib.CipherParams.create({
                      ciphertext: CryptoJS.enc.Hex.parse(encryptedText),
                    });
                    var decryptedData = CryptoJS.enc.Utf8.stringify(
                      CryptoJS.AES.decrypt(cipherParams, pkBlocks, {
                        iv: iv,
                        mode: CryptoJS.mode.CBC,
                        padding: CryptoJS.pad.Pkcs7,
                      })
                    );
                    return decryptedData;
                }
                
                function convertToHex(value) {
                    return CryptoJS.enc.Hex.stringify(CryptoJS.enc.Utf8.parse(value));
                }
                
                async function processCryptoData() {
                    const inputText = cryptoInput.value.trim();
                    const operation = cryptoOperationSelect.value;
                    const key = cryptoKeyInput.value;
                    const iv = cryptoIvInput.value;
                    const base64Check = cryptoBase64Check.checked;
                    const outputType = cryptoImageOption.value;
                    const imageSource = cryptoImageSource.value;
                    
                    if (!inputText) {
                        alert('è¯·è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬');
                        return;
                    }
                    
                    try {
                        let result;
                        
                        if (operation === 'encrypt') {
                            const resultData = Encrypt(inputText, key, iv);
                            const keyHex = convertToHex(`$#${key}#$`);
                            const ivHex = convertToHex(iv);
                            result = `${keyHex}${resultData}${ivHex}`;
                            
                            // å¦‚æœæ˜¯åŠ å¯†æ“ä½œä¸”é€‰æ‹©å›¾ç‰‡è¾“å‡º
                            if (outputType === 'image') {
                                let originalImage = null;
                                if (imageSource === 'existing' && cryptoImageUrl.value) {
                                    try {
                                        originalImage = await imageUrlToBase64(cryptoImageUrl.value);
                                    } catch (error) {
                                        console.warn('ä½¿ç”¨åŸå›¾å¤±è´¥ï¼Œå°†ç”Ÿæˆæ–°å›¾ç‰‡:', error);
                                    }
                                }
                                
                                const blob = await generateConfigImage(result, originalImage);
                                
                                // è®¾ç½®ä¸‹è½½æŒ‰é’®
                                cryptoDownloadImg.onclick = function() {
                                    downloadBlob(blob, 'tvbox-config.png');
                                };
                                
                                // è®¾ç½®å¤åˆ¶æŒ‰é’®
                                cryptoCopyImg.onclick = function() {
                                    copyCanvasToClipboard();
                                };
                                
                                // è®¾ç½®Giteeé…ç½®æŒ‰é’®
                                cryptoUploadGitee.onclick = function() {
                                    showGiteeConfig(blob);
                                };
                                
                                // æ˜¾ç¤ºé¢„è§ˆ
                                showImagePreview(blob);
                                return;
                            }
                        } else {
                            let encryptedData = inputText;
                            if (base64Check) {
                                encryptedData = window.atob(encryptedData.split("**")[1] || encryptedData);
                            }
                            result = decryptAesBCB(encryptedData);
                        }
                        
                        cryptoOutput.value = result;
                    } catch (err) {
                        console.error(err);
                        alert('å¤„ç†å¤±è´¥: ' + err.message);
                    }
                }
                
                function copyCryptoResult() {
                    cryptoOutput.select();
                    document.execCommand('copy');
                    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }
            }

            // åˆå§‹åŒ–åŠ è§£å¯†å·¥å…·
            initCrypto();
            // åˆå§‹åŒ–å›¾ç‰‡åŠ å¯†åŠŸèƒ½
            initImageCrypto();

            // æ·»åŠ ç‚¹æ’­æº
            addVodBtn.addEventListener('click', function() {
                const key = document.getElementById('vod-key').value.trim();
                const name = document.getElementById('vod-name').value.trim();
                const api = document.getElementById('vod-api').value.trim();
                const jar = vodJarInput.value.trim();
                const ext = vodExtInput.value.trim();
                
                if (!key || !name || !api) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„ç‚¹æ’­æºä¿¡æ¯!');
                    return;
                }
                
                const newSite = {
                    key: key,
                    name: name,
                    type: parseInt(document.getElementById('vod-type').value),
                    api: api,
                    searchable: parseInt(document.getElementById('vod-searchable').value),
                    quickSearch: parseInt(document.getElementById('vod-quickSearch').value),
                    filterable: parseInt(document.getElementById('vod-filterable').value)
                };
                
                if (jar) {
                    newSite.jar = jar;
                }
                
                if (ext) {
                    newSite.ext = ext;
                }
                
                // æ·»åŠ è‡ªå®šä¹‰å­—æ®µåˆ°é…ç½®
                Object.values(customFields).forEach(field => {
                    if (field.name && field.value) {
                        newSite[field.name] = field.value;
                    }
                });
                
                // ä¿®æ”¹ï¼šåªæœ‰å½“ç”¨æˆ·æ·»åŠ äº†åˆ†ç±»æ—¶æ‰ä¿å­˜åˆ°é…ç½®ä¸­ï¼Œå¦åˆ™ä¸ä¿å­˜categorieså­—æ®µ
                if (config.categories && config.categories.length > 0) {
                    newSite.categories = [...config.categories];
                }
                
                config.sites.push(newSite);
                updateConfigJson();
                loadVodItems();
                updateVodNavigation(); // æ–°å¢ï¼šæ›´æ–°å¯¼èˆªæ 
                
                // ä¿®æ”¹ï¼šæ·»åŠ ç‚¹æ’­æºåï¼Œæ¸…ç©ºè¡¨å•å­—æ®µå’Œåˆ†ç±»é…ç½®ï¼Œå¹¶æ¢å¤Typeã€å¯æœç´¢ã€å¯å¿«é€Ÿæœç´¢ã€å¯ç­›é€‰åˆ°é»˜è®¤çŠ¶æ€
                clearVodForm();
                config.categories = []; // æ¸…ç©ºåˆ†ç±»é…ç½®
                loadCategories(); // æ›´æ–°åˆ†ç±»æ˜¾ç¤º
                
                // ä¿®æ”¹ï¼šæ¢å¤åˆ†ç±»é€‰æ‹©æ¡†é»˜è®¤å€¼ä¸º"ç”µå½±ç‰‡"
                categorySelect.value = "ç”µå½±ç‰‡";
                customCategoryInput.value = "";
            });

            // æ›´æ–°ç‚¹æ’­æº
            updateVodBtn.addEventListener('click', function() {
                if (editingIndex === -1) return;
                
                const key = document.getElementById('vod-key').value.trim();
                const name = document.getElementById('vod-name').value.trim();
                const api = document.getElementById('vod-api').value.trim();
                const jar = vodJarInput.value.trim();
                const ext = vodExtInput.value.trim();
                
                if (!key || !name || !api) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„ç‚¹æ’­æºä¿¡æ¯!');
                    return;
                }
                
                const updatedSite = {
                    key: key,
                    name: name,
                    type: parseInt(document.getElementById('vod-type').value),
                    api: api,
                    searchable: parseInt(document.getElementById('vod-searchable').value),
                    quickSearch: parseInt(document.getElementById('vod-quickSearch').value),
                    filterable: parseInt(document.getElementById('vod-filterable').value)
                };
                
                if (jar) {
                    updatedSite.jar = jar;
                }
                
                if (ext) {
                    updatedSite.ext = ext;
                }
                
                // æ·»åŠ è‡ªå®šä¹‰å­—æ®µåˆ°é…ç½®
                Object.values(customFields).forEach(field => {
                    if (field.name && field.value) {
                        updatedSite[field.name] = field.value;
                    }
                });
                
                // ä¿®æ”¹ï¼šåªæœ‰å½“ç”¨æˆ·æ·»åŠ äº†åˆ†ç±»æ—¶æ‰ä¿å­˜åˆ°é…ç½®ä¸­ï¼Œå¦åˆ™ä¸ä¿å­˜categorieså­—æ®µ
                if (config.categories && config.categories.length > 0) {
                    updatedSite.categories = [...config.categories];
                }
                
                config.sites[editingIndex] = updatedSite;
                updateConfigJson();
                loadVodItems();
                updateVodNavigation(); // æ–°å¢ï¼šæ›´æ–°å¯¼èˆªæ 
                
                cancelEdit();
            });

            // å–æ¶ˆç¼–è¾‘
            cancelEditBtn.addEventListener('click', function() {
                cancelEdit();
            });

            function cancelEdit() {
                editingIndex = -1;
                addVodBtn.style.display = 'inline-block';
                updateVodBtn.style.display = 'none';
                cancelEditBtn.style.display = 'none';
                clearVodForm();
                // æ–°å¢ï¼šæ¸…ç©ºåˆ†ç±»é…ç½®ï¼Œæ¢å¤åˆ°é»˜è®¤è®¾ç½®
                config.categories = [];
                loadCategories();
                // æ–°å¢ï¼šå–æ¶ˆå¯¼èˆªæŒ‰é’®é«˜äº®
                document.querySelectorAll('.vod-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }

            function clearVodForm() {
                document.getElementById('vod-key').value = '';
                document.getElementById('vod-name').value = '';
                document.getElementById('vod-api').value = '';
                vodJarInput.value = '';
                vodExtInput.value = '';
                // æ¢å¤Typeã€å¯æœç´¢ã€å¯å¿«é€Ÿæœç´¢ã€å¯ç­›é€‰åˆ°é»˜è®¤çŠ¶æ€
                document.getElementById('vod-type').value = '1';
                document.getElementById('vod-searchable').value = '1';
                document.getElementById('vod-quickSearch').value = '1';
                document.getElementById('vod-filterable').value = '1';
                customFieldsContainer.innerHTML = '';
                customFields = {};
            }

            // æ·»åŠ UrlsæŒ‰é’®
            addUrlBtn.addEventListener('click', function() {
                const urlItem = document.createElement('div');
                urlItem.className = 'url-item';
                urlItem.innerHTML = `
                    <input type="text" class="live-url" placeholder="ç›´æ’­æºUrls">
                    <button class="remove-url button-cancel">åˆ é™¤</button>
                `;
                liveUrlsList.appendChild(urlItem);
                
                urlItem.querySelector('.remove-url').addEventListener('click', function() {
                    urlItem.remove();
                });
            });

            // æ·»åŠ ç›´æ’­é¢‘é“
            addLiveChannelBtn.addEventListener('click', function() {
                const group = liveGroupInput.value.trim();
                const name = liveChannelNameInput.value.trim();
                const urlInputs = document.querySelectorAll('.live-url');
                const urls = Array.from(urlInputs).map(input => input.value.trim()).filter(url => url);
                
                if (!group || !name || urls.length === 0) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„ç›´æ’­é¢‘é“ä¿¡æ¯!');
                    return;
                }
                
                let liveGroup = config.lives.find(g => g.group === group);
                
                if (!liveGroup) {
                    liveGroup = {
                        group: group,
                        channels: []
                    };
                    config.lives.push(liveGroup);
                }
                
                liveGroup.channels.push({
                    name: name,
                    urls: urls
                });
                
                updateConfigJson();
                loadLiveChannels();
                
                clearLiveForm();
            });

            // æ›´æ–°ç›´æ’­é¢‘é“
            updateLiveChannelBtn.addEventListener('click', function() {
                if (editingLiveGroupIndex === -1 || editingLiveChannelIndex === -1) return;
                
                const group = liveGroupInput.value.trim();
                const name = liveChannelNameInput.value.trim();
                const urlInputs = document.querySelectorAll('.live-url');
                const urls = Array.from(urlInputs).map(input => input.value.trim()).filter(url => url);
                
                if (!group || !name || urls.length === 0) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„ç›´æ’­é¢‘é“ä¿¡æ¯!');
                    return;
                }
                
                // å¦‚æœç»„åæ”¹å˜äº†ï¼Œéœ€è¦åˆ›å»ºæ–°ç»„
                if (group !== config.lives[editingLiveGroupIndex].group) {
                    // ä»åŸç»„åˆ é™¤
                    config.lives[editingLiveGroupIndex].channels.splice(editingLiveChannelIndex, 1);
                    
                    // å¦‚æœåŸç»„ç©ºäº†ï¼Œåˆ é™¤ç»„
                    if (config.lives[editingLiveGroupIndex].channels.length === 0) {
                        config.lives.splice(editingLiveGroupIndex, 1);
                    }
                    
                    // æŸ¥æ‰¾æˆ–åˆ›å»ºæ–°ç»„
                    let newGroup = config.lives.find(g => g.group === group);
                    if (!newGroup) {
                        newGroup = {
                            group: group,
                            channels: []
                        };
                        config.lives.push(newGroup);
                    }
                    
                    // æ·»åŠ åˆ°æ–°ç»„
                    newGroup.channels.push({
                        name: name,
                        urls: urls
                    });
                } else {
                    // ç»„åæ²¡å˜ï¼Œç›´æ¥æ›´æ–°
                    config.lives[editingLiveGroupIndex].channels[editingLiveChannelIndex] = {
                        name: name,
                        urls: urls
                    };
                }
                
                updateConfigJson();
                loadLiveChannels();
                
                cancelLiveEdit();
            });

            // å–æ¶ˆç›´æ’­ç¼–è¾‘
            cancelLiveEditBtn.addEventListener('click', function() {
                cancelLiveEdit();
            });

            function cancelLiveEdit() {
                editingLiveGroupIndex = -1;
                editingLiveChannelIndex = -1;
                addLiveChannelBtn.style.display = 'inline-block';
                updateLiveChannelBtn.style.display = 'none';
                cancelLiveEditBtn.style.display = 'none';
                clearLiveForm();
            }

            function clearLiveForm() {
                liveGroupInput.value = '';
                liveChannelNameInput.value = '';
                liveUrlsList.innerHTML = `
                    <div class="url-item">
                        <input type="text" class="live-url" placeholder="ç›´æ’­æºUrls">
                        <button class="remove-url button-cancel">åˆ é™¤</button>
                    </div>
                `;
                
                document.querySelectorAll('.remove-url').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.parentElement.remove();
                    });
                });
            }

            // æ·»åŠ è§£æåœ°å€
            addParseBtn.addEventListener('click', function() {
                const name = document.getElementById('parse-name').value.trim();
                const type = parseInt(document.getElementById('parse-type').value);
                const url = parseUrlInput.value.trim();
                const ext = parseExtInput.value.trim();
                
                if (!name || !url) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„è§£æåœ°å€ä¿¡æ¯!');
                    return;
                }
                
                const newParse = {
                    name: name,
                    type: type,
                    url: url
                };
                
                if (ext) {
                    newParse.ext = ext;
                }
                
                config.parses.push(newParse);
                
                updateConfigJson();
                loadParses();
                
                clearParseForm();
            });

            // æ›´æ–°è§£æåœ°å€
            updateParseBtn.addEventListener('click', function() {
                if (editingParseIndex === -1) return;
                
                const name = document.getElementById('parse-name').value.trim();
                const type = parseInt(document.getElementById('parse-type').value);
                const url = parseUrlInput.value.trim();
                const ext = parseExtInput.value.trim();
                
                if (!name || !url) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„è§£æåœ°å€ä¿¡æ¯!');
                    return;
                }
                
                const updatedParse = {
                    name: name,
                    type: type,
                    url: url
                };
                
                if (ext) {
                    updatedParse.ext = ext;
                }
                
                config.parses[editingParseIndex] = updatedParse;
                
                updateConfigJson();
                loadParses();
                
                cancelParseEdit();
            });

            // å–æ¶ˆè§£æç¼–è¾‘
            cancelParseEditBtn.addEventListener('click', function() {
                cancelParseEdit();
            });

            function cancelParseEdit() {
                editingParseIndex = -1;
                addParseBtn.style.display = 'inline-block';
                updateParseBtn.style.display = 'none';
                cancelParseEditBtn.style.display = 'none';
                clearParseForm();
            }

            function clearParseForm() {
                document.getElementById('parse-name').value = '';
                document.getElementById('parse-type').value = '0';
                parseUrlInput.value = '';
                parseExtInput.value = '';
            }

            // æ·»åŠ åˆ†ç±»
            addCategoryBtn.addEventListener('click', function() {
                let category = customCategoryInput.value.trim();
                if (!category) {
                    // å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰åˆ†ç±»ï¼Œä½¿ç”¨ä¸‹æ‹‰æ¡†ä¸­çš„åˆ†ç±»
                    category = categorySelect.value;
                }
                
                if (!category) {
                    alert('è¯·é€‰æ‹©æˆ–è¾“å…¥åˆ†ç±»åç§°');
                    return;
                }
                
                if (!config.categories) {
                    config.categories = [];
                }
                
                if (!config.categories.includes(category)) {
                    config.categories.push(category);
                    updateConfigJson();
                    loadCategories();
                    
                    // æ¸…ç©ºè‡ªå®šä¹‰åˆ†ç±»è¾“å…¥æ¡†
                    customCategoryInput.value = '';
                }
            });

            // æ·»åŠ IJKè§£ç é€‰é¡¹
            addIjkOptionBtn.addEventListener('click', function() {
                const group = ijkGroupSelect.value;
                const category = ijkCategorySelect.value;
                const name = ijkNameInput.value.trim();
                const value = ijkValueInput.value.trim();
                
                if (!name || !value) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„è§£ç é€‰é¡¹ä¿¡æ¯!');
                    return;
                }
                
                // æ‰¾åˆ°å¯¹åº”çš„è§£ç ç»„
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? 'è½¯è§£ç ' : 'ç¡¬è§£ç '));
                
                if (!ijkGroup) {
                    alert('æ‰¾ä¸åˆ°å¯¹åº”çš„è§£ç ç»„!');
                    return;
                }
                
                // æ·»åŠ æ–°é€‰é¡¹
                ijkGroup.options.push({
                    category: parseInt(category),
                    name: name,
                    value: value
                });
                
                // æ›´æ–°æ–‡æœ¬åŒºåŸŸæ˜¾ç¤º
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                clearIjkForm();
                
                // è‡ªåŠ¨æ›´æ–°é…ç½®
                updateConfigJson();
            });

            // æ›´æ–°IJKè§£ç é€‰é¡¹
            updateIjkOptionBtn.addEventListener('click', function() {
                if (editingIjkOptionIndex === -1) return;
                
                const group = ijkGroupSelect.value;
                const category = ijkCategorySelect.value;
                const name = ijkNameInput.value.trim();
                const value = ijkValueInput.value.trim();
                
                if (!name || !value) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„è§£ç é€‰é¡¹ä¿¡æ¯!');
                    return;
                }
                
                // æ‰¾åˆ°å¯¹åº”çš„è§£ç ç»„
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? 'è½¯è§£ç ' : 'ç¡¬è§£ç '));
                
                if (!ijkGroup) {
                    alert('æ‰¾ä¸åˆ°å¯¹åº”çš„è§£ç ç»„!');
                    return;
                }
                
                // æ›´æ–°é€‰é¡¹
                ijkGroup.options[editingIjkOptionIndex] = {
                    category: parseInt(category),
                    name: name,
                    value: value
                };
                
                // æ›´æ–°æ–‡æœ¬åŒºåŸŸæ˜¾ç¤º
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // å–æ¶ˆç¼–è¾‘çŠ¶æ€
                cancelIjkEdit();
                
                // è‡ªåŠ¨æ›´æ–°é…ç½®
                updateConfigJson();
            });

            // å–æ¶ˆIJKç¼–è¾‘
            cancelIjkEditBtn.addEventListener('click', function() {
                cancelIjkEdit();
            });

            function cancelIjkEdit() {
                editingIjkOptionIndex = -1;
                addIjkOptionBtn.style.display = 'inline-block';
                updateIjkOptionBtn.style.display = 'none';
                cancelIjkEditBtn.style.display = 'none';
                clearIjkForm();
            }

            function clearIjkForm() {
                ijkCategorySelect.value = '4';
                ijkNameInput.value = '';
                ijkValueInput.value = '';
            }

            // æ›´æ–°IJKé€‰é¡¹æ–‡æœ¬åŒºåŸŸ
            function updateIjkOptionsTextarea() {
                const group = ijkGroupSelect.value;
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? 'è½¯è§£ç ' : 'ç¡¬è§£ç '));
                
                if (ijkGroup) {
                    ijkOptionsTextarea.value = 
                        ijkGroup.options.map(opt => `${opt.category}|${opt.name}|${opt.value}`).join('\n');
                }
            }

            // åŠ è½½IJKé€‰é¡¹åˆ—è¡¨
            function loadIjkOptions() {
                ijkOptionsList.innerHTML = '';
                
                const group = ijkGroupSelect.value;
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? 'è½¯è§£ç ' : 'ç¡¬è§£ç '));
                
                if (!ijkGroup || ijkGroup.options.length === 0) {
                    return;
                }
                
                ijkGroup.options.forEach((option, index) => {
                    const item = document.createElement('div');
                    item.className = 'ijk-option-item';
                    item.innerHTML = `
                        <select disabled>
                            <option value="1" ${option.category === 1 ? 'selected' : ''}>1-OPT_CATEGORY_FORMAT</option>
                            <option value="2" ${option.category === 2 ? 'selected' : ''}>2-OPT_CATEGORY_CODEC</option>
                            <option value="3" ${option.category === 3 ? 'selected' : ''}>3-OPT_CATEGORY_SWS</option>
                            <option value="4" ${option.category === 4 ? 'selected' : ''}>4-OPT_CATEGORY_PLAYER</option>
                        </select>
                        <input type="text" value="${option.name}" disabled>
                        <input type="text" value="${option.value}" disabled>
                        <button class="button-edit edit-ijk-option" data-index="${index}">ç¼–è¾‘</button>
                        <button class="button-cancel delete-ijk-option" data-index="${index}">åˆ é™¤</button>
                    `;
                    ijkOptionsList.appendChild(item);
                });
                
                // æ·»åŠ ç¼–è¾‘äº‹ä»¶
                document.querySelectorAll('.edit-ijk-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const group = ijkGroupSelect.value;
                        const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? 'è½¯è§£ç ' : 'ç¡¬è§£ç '));
                        const option = ijkGroup.options[index];
                        
                        // å¡«å……è¡¨å•
                        ijkCategorySelect.value = option.category;
                        ijkNameInput.value = option.name;
                        ijkValueInput.value = option.value;
                        
                        // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                        editingIjkOptionIndex = index;
                        addIjkOptionBtn.style.display = 'none';
                        updateIjkOptionBtn.style.display = 'inline-block';
                        cancelIjkEditBtn.style.display = 'inline-block';
                    });
                });
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                document.querySelectorAll('.delete-ijk-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const group = ijkGroupSelect.value;
                        const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? 'è½¯è§£ç ' : 'ç¡¬è§£ç '));
                        
                        ijkGroup.options.splice(index, 1);
                        
                        // æ›´æ–°æ–‡æœ¬åŒºåŸŸæ˜¾ç¤º
                        updateIjkOptionsTextarea();
                        loadIjkOptions();
                        updateConfigJson();
                    });
                });
            }

            // IJKè§£ç ç»„åˆ‡æ¢
            ijkGroupSelect.addEventListener('change', function() {
                updateIjkOptionsTextarea();
                loadIjkOptions();
                clearIjkForm();
            });

            // åŠ è½½åˆ†ç±»åˆ—è¡¨
            function loadCategories() {
                categoriesList.innerHTML = '';
                
                if (!config.categories || config.categories.length === 0) {
                    return;
                }
                
                config.categories.forEach((category, index) => {
                    const tag = document.createElement('div');
                    tag.className = 'category-tag';
                    tag.innerHTML = `
                        ${category}
                        <button data-index="${index}" class="delete-category">Ã—</button>
                    `;
                    categoriesList.appendChild(tag);
                });
                
                document.querySelectorAll('.delete-category').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.categories.splice(index, 1);
                        updateConfigJson();
                        loadCategories();
                    });
                });
            }

            // åŠ è½½ç‚¹æ’­æºåˆ—è¡¨
            function loadVodItems() {
                vodItems.innerHTML = '';
                
                if (config.sites.length === 0) {
                    return;
                }
                
                config.sites.forEach((site, index) => {
                    const item = document.createElement('div');
                    item.className = 'source-item';
                    item.draggable = true;
                    item.dataset.index = index;
                    
                    let categoriesHtml = '';
                    // ä¿®æ”¹ï¼šåªæœ‰å½“ç«™ç‚¹æœ‰åˆ†ç±»é…ç½®æ—¶æ‰æ˜¾ç¤ºåˆ†ç±»ä¿¡æ¯
                    if (site.categories && site.categories.length > 0) {
                        categoriesHtml = `<p>åˆ†ç±»: ${site.categories.join(', ')}</p>`;
                    }
                    
                    let jarHtml = site.jar ? `<p>JAR: ${site.jar}</p>` : '';
                    let extHtml = site.ext ? `<p>Ext: ${site.ext}</p>` : '';
                    
                    // æ·»åŠ è‡ªå®šä¹‰å­—æ®µæ˜¾ç¤º
                    let customFieldsHtml = '';
                    const customFields = {};
                    for (const key in site) {
                        if (!['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'].includes(key)) {
                            customFields[key] = site[key];
                        }
                    }
                    
                    if (Object.keys(customFields).length > 0) {
                        customFieldsHtml = Object.entries(customFields).map(([name, value]) => 
                            `<p>${name}: ${value}</p>`
                        ).join('');
                    }
                    
                    item.innerHTML = `
                        <span class="drag-handle">â˜°</span>
                        <div style="flex: 1;">
                            <h4>${site.name} (${site.key})</h4>
                            <p>API: ${site.api}</p>
                            ${jarHtml}
                            <p>ç±»å‹: ${getTypeName(site.type)} | å¯æœç´¢: ${site.searchable} | å¯å¿«é€Ÿæœç´¢: ${site.quickSearch} | å¯ç­›é€‰: ${site.filterable}</p>
                            ${extHtml}
                            ${categoriesHtml}
                            ${customFieldsHtml}
                        </div>
                        <div class="source-item-actions">
                            <button data-index="${index}" class="button-edit edit-vod">ç¼–è¾‘</button>
                            <button data-index="${index}" class="button-cancel delete-vod">åˆ é™¤</button>
                        </div>
                    `;
                    vodItems.appendChild(item);
                    
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('dragleave', handleDragLeave);
                    item.addEventListener('drop', handleDrop);
                    item.addEventListener('dragend', handleDragEnd);
                    
                    const dragHandle = item.querySelector('.drag-handle');
                    dragHandle.addEventListener('mousedown', function() {
                        item.draggable = true;
                    });
                    dragHandle.addEventListener('mouseup', function() {
                        item.draggable = false;
                    });
                });
                
                // æ·»åŠ ç¼–è¾‘äº‹ä»¶
                document.querySelectorAll('.edit-vod').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const site = config.sites[index];
                        
                        // å¡«å……è¡¨å•
                        document.getElementById('vod-key').value = site.key;
                        document.getElementById('vod-name').value = site.name;
                        document.getElementById('vod-type').value = site.type;
                        document.getElementById('vod-api').value = site.api;
                        vodJarInput.value = site.jar || '';
                        document.getElementById('vod-searchable').value = site.searchable;
                        document.getElementById('vod-quickSearch').value = site.quickSearch;
                        document.getElementById('vod-filterable').value = site.filterable;
                        vodExtInput.value = site.ext || '';
                        
                        // æ›´æ–°åˆ†ç±»
                        if (site.categories && site.categories.length > 0) {
                            config.categories = [...site.categories];
                            loadCategories();
                        } else {
                            config.categories = [];
                            loadCategories();
                        }
                        
                        // æ›´æ–°è‡ªå®šä¹‰å­—æ®µ
                        customFieldsContainer.innerHTML = '';
                        customFields = {};
                        
                        // è·å–è‡ªå®šä¹‰å­—æ®µ - æ’é™¤extå­—æ®µ
                        for (const key in site) {
                            if (!['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'].includes(key)) {
                                const fieldId = 'custom-field-' + Date.now() + Math.random().toString(36).substr(2, 5);
                                const fieldItem = document.createElement('div');
                                fieldItem.className = 'custom-field-item';
                                fieldItem.dataset.id = fieldId;
                                
                                // ç›´æ¥è®¾ç½®å€¼ï¼Œä¸å…³å¿ƒç±»å‹
                                let fieldValue = site[key];
                                if (typeof fieldValue === 'object') {
                                    fieldValue = JSON.stringify(fieldValue);
                                }
                                
                                fieldItem.innerHTML = `
                                    <input type="text" class="custom-field-name" placeholder="å­—æ®µå" value="${key}">
                                    <input type="text" class="custom-field-value" placeholder="å­—æ®µå€¼" value="${fieldValue}">
                                    <button class="button-cancel remove-custom-field">åˆ é™¤</button>
                                `;
                                
                                customFieldsContainer.appendChild(fieldItem);
                                
                                // æ·»åŠ åˆ é™¤äº‹ä»¶
                                fieldItem.querySelector('.remove-custom-field').addEventListener('click', function() {
                                    fieldItem.remove();
                                    delete customFields[fieldId];
                                    updateConfigJson();
                                });
                                
                                // æ·»åŠ è¾“å…¥äº‹ä»¶
                                const nameInput = fieldItem.querySelector('.custom-field-name');
                                const valueInput = fieldItem.querySelector('.custom-field-value');
                                
                                const updateCustomField = function() {
                                    if (nameInput.value.trim() && valueInput.value.trim()) {
                                        customFields[fieldId] = {
                                            name: nameInput.value.trim(),
                                            value: valueInput.value.trim()
                                        };
                                    } else {
                                        delete customFields[fieldId];
                                    }
                                    updateConfigJson();
                                };
                                
                                nameInput.addEventListener('input', updateCustomField);
                                valueInput.addEventListener('input', updateCustomField);
                                
                                // æ·»åŠ åˆ°customFieldså¯¹è±¡
                                customFields[fieldId] = {
                                    name: key,
                                    value: fieldValue
                                };
                            }
                        }
                        
                        // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                        editingIndex = index;
                        addVodBtn.style.display = 'none';
                        updateVodBtn.style.display = 'inline-block';
                        cancelEditBtn.style.display = 'inline-block';
                        
                        // æ–°å¢ï¼šé«˜äº®å¯¹åº”çš„å¯¼èˆªæŒ‰é’®
                        highlightNavButton(index);
                        
                        // æ–°å¢ï¼šæ»šåŠ¨åˆ°ç‚¹æ’­æºé…ç½®åŒºåŸŸ
                        document.getElementById('vod-config').scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    });
                });
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                document.querySelectorAll('.delete-vod').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.sites.splice(index, 1);
                        updateConfigJson();
                        loadVodItems();
                        updateVodNavigation(); // æ–°å¢ï¼šæ›´æ–°å¯¼èˆªæ 
                    });
                });
            }
            
            // åŠ è½½ç›´æ’­é¢‘é“åˆ—è¡¨
            function loadLiveChannels() {
                liveChannelsList.innerHTML = '';
                
                if (config.lives.length === 0) {
                    return;
                }
                
                config.lives.forEach((group, groupIndex) => {
                    const groupHeader = document.createElement('h4');
                    groupHeader.textContent = `ç»„å: ${group.group}`;
                    groupHeader.style.marginTop = '20px';
                    groupHeader.style.marginBottom = '10px';
                    groupHeader.style.color = 'var(--primary-color)';
                    liveChannelsList.appendChild(groupHeader);
                    
                    group.channels.forEach((channel, channelIndex) => {
                        const item = document.createElement('div');
                        item.className = 'channel-item';
                        item.draggable = true;
                        item.dataset.group = groupIndex;
                        item.dataset.channel = channelIndex;
                        
                        let urlsHtml = '';
                        channel.urls.forEach((url, urlIndex) => {
                            urlsHtml += `<p>Urls: ${url}</p>`;
                        });
                        
                        item.innerHTML = `
                            <div style="flex: 1;">
                                <p><strong>é¢‘é“å:</strong> ${channel.name}</p>
                                ${urlsHtml}
                            </div>
                            <div class="channel-item-actions">
                                <button data-group="${groupIndex}" data-channel="${channelIndex}" class="button-edit edit-live-channel">ç¼–è¾‘</button>
                                <button data-group="${groupIndex}" data-channel="${channelIndex}" class="button-cancel delete-live-channel">åˆ é™¤</button>
                            </div>
                        `;
                        liveChannelsList.appendChild(item);
                        
                        item.addEventListener('dragstart', handleLiveDragStart);
                        item.addEventListener('dragover', handleLiveDragOver);
                        item.addEventListener('dragleave', handleLiveDragLeave);
                        item.addEventListener('drop', handleLiveDrop);
                        item.addEventListener('dragend', handleLiveDragEnd);
                    });
                });
                
                // æ·»åŠ ç¼–è¾‘äº‹ä»¶
                document.querySelectorAll('.edit-live-channel').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const groupIndex = parseInt(this.dataset.group);
                        const channelIndex = parseInt(this.dataset.channel);
                        const channel = config.lives[groupIndex].channels[channelIndex];
                        
                        // å¡«å……è¡¨å•
                        liveGroupInput.value = config.lives[groupIndex].group;
                        liveChannelNameInput.value = channel.name;
                        
                        // æ¸…ç©ºå¹¶æ·»åŠ URLè¾“å…¥æ¡†
                        liveUrlsList.innerHTML = '';
                        channel.urls.forEach(url => {
                            const urlItem = document.createElement('div');
                            urlItem.className = 'url-item';
                            urlItem.innerHTML = `
                                <input type="text" class="live-url" placeholder="ç›´æ’­æºUrls" value="${url}">
                                <button class="remove-url button-cancel">åˆ é™¤</button>
                            `;
                            liveUrlsList.appendChild(urlItem);
                            
                            urlItem.querySelector('.remove-url').addEventListener('click', function() {
                                urlItem.remove();
                            });
                        });
                        
                        // å¦‚æœæ²¡æœ‰URLè¾“å…¥æ¡†ï¼Œæ·»åŠ ä¸€ä¸ªç©ºçš„
                        if (liveUrlsList.children.length === 0) {
                            const urlItem = document.createElement('div');
                            urlItem.className = 'url-item';
                            urlItem.innerHTML = `
                                <input type="text" class="live-url" placeholder="ç›´æ’­æºUrls">
                                <button class="remove-url button-cancel">åˆ é™¤</button>
                            `;
                            liveUrlsList.appendChild(urlItem);
                            
                            urlItem.querySelector('.remove-url').addEventListener('click', function() {
                                urlItem.remove();
                            });
                        }
                        
                        // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                        editingLiveGroupIndex = groupIndex;
                        editingLiveChannelIndex = channelIndex;
                        addLiveChannelBtn.style.display = 'none';
                        updateLiveChannelBtn.style.display = 'inline-block';
                        cancelLiveEditBtn.style.display = 'inline-block';
                    });
                });
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                document.querySelectorAll('.delete-live-channel').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const groupIndex = parseInt(this.dataset.group);
                        const channelIndex = parseInt(this.dataset.channel);
                        
                        config.lives[groupIndex].channels.splice(channelIndex, 1);
                        
                        if (config.lives[groupIndex].channels.length === 0) {
                            config.lives.splice(groupIndex, 1);
                        }
                        
                        updateConfigJson();
                        loadLiveChannels();
                    });
                });
            }
            
            // åŠ è½½è§£æåœ°å€åˆ—è¡¨
            function loadParses() {
                parseList.innerHTML = '';
                
                if (config.parses.length === 0) {
                    return;
                }
                
                config.parses.forEach((parse, index) => {
                    const item = document.createElement('div');
                    item.className = 'parse-item';
                    item.draggable = true;
                    item.dataset.index = index;
                    
                    let extHtml = parse.ext ? `<p><strong>Ext:</strong> ${parse.ext}</p>` : '';
                    
                    item.innerHTML = `
                        <div style="flex: 1;">
                            <p><strong>åç§°:</strong> ${parse.name} (ç±»å‹: ${getParseTypeName(parse.type)})</p>
                            <p><strong>URL:</strong> ${parse.url}</p>
                            ${extHtml}
                        </div>
                        <div class="parse-item-actions">
                            <button data-index="${index}" class="button-edit edit-parse">ç¼–è¾‘</button>
                            <button data-index="${index}" class="button-cancel delete-parse">åˆ é™¤</button>
                        </div>
                    `;
                    parseList.appendChild(item);
                    
                    item.addEventListener('dragstart', handleParseDragStart);
                    item.addEventListener('dragover', handleParseDragOver);
                    item.addEventListener('dragleave', handleParseDragLeave);
                    item.addEventListener('drop', handleParseDrop);
                    item.addEventListener('dragend', handleParseDragEnd);
                });
                
                // æ·»åŠ ç¼–è¾‘äº‹ä»¶
                document.querySelectorAll('.edit-parse').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const parse = config.parses[index];
                        
                        // å¡«å……è¡¨å•
                        document.getElementById('parse-name').value = parse.name;
                        document.getElementById('parse-type').value = parse.type;
                        parseUrlInput.value = parse.url;
                        parseExtInput.value = parse.ext || '';
                        
                        // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                        editingParseIndex = index;
                        addParseBtn.style.display = 'none';
                        updateParseBtn.style.display = 'inline-block';
                        cancelParseEditBtn.style.display = 'inline-block';
                    });
                });
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶
                document.querySelectorAll('.delete-parse').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.parses.splice(index, 1);
                        updateConfigJson();
                        loadParses();
                    });
                });
            }
            
            // ç‚¹æ’­æºæ‹–åŠ¨ç›¸å…³å‡½æ•°
            function handleDragStart(e) {
                draggedItem = this;
                dragStartIndex = parseInt(this.dataset.index);
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndIndex = parseInt(this.dataset.index);
                if (dragStartIndex !== dragEndIndex) {
                    // ä»åŸä½ç½®ç§»é™¤æ‹–åŠ¨çš„é¡¹ç›®
                    const [movedItem] = config.sites.splice(dragStartIndex, 1);
                    
                    // æ’å…¥åˆ°æ–°ä½ç½®
                    config.sites.splice(dragEndIndex, 0, movedItem);
                    
                    loadVodItems();
                    updateConfigJson();
                    updateVodNavigation(); // æ–°å¢ï¼šæ›´æ–°å¯¼èˆªæ 
                }
            }
            
            function handleDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            // ç›´æ’­é¢‘é“æ‹–åŠ¨ç›¸å…³å‡½æ•°
            function handleLiveDragStart(e) {
                draggedItem = this;
                const groupIndex = parseInt(this.dataset.group);
                const channelIndex = parseInt(this.dataset.channel);
                dragStartIndex = { group: groupIndex, channel: channelIndex };
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleLiveDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleLiveDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleLiveDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndGroupIndex = parseInt(this.dataset.group);
                const dragEndChannelIndex = parseInt(this.dataset.channel);
                
                if (dragStartIndex.group !== dragEndGroupIndex || dragStartIndex.channel !== dragEndChannelIndex) {
                    // è·å–è¦ç§»åŠ¨çš„é¢‘é“
                    const channelToMove = config.lives[dragStartIndex.group].channels[dragStartIndex.channel];
                    
                    // ä»åŸä½ç½®åˆ é™¤
                    config.lives[dragStartIndex.group].channels.splice(dragStartIndex.channel, 1);
                    
                    // å¦‚æœåŸç»„ç©ºäº†ï¼Œåˆ é™¤ç»„
                    if (config.lives[dragStartIndex.group].channels.length === 0) {
                        config.lives.splice(dragStartIndex.group, 1);
                    }
                    
                    // æ·»åŠ åˆ°æ–°ä½ç½®
                    const targetGroup = config.lives[dragEndGroupIndex];
                    targetGroup.channels.splice(dragEndChannelIndex, 0, channelToMove);
                    
                    loadLiveChannels();
                    updateConfigJson();
                }
            }
            
            function handleLiveDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            // è§£æåœ°å€æ‹–åŠ¨ç›¸å…³å‡½æ•°
            function handleParseDragStart(e) {
                draggedItem = this;
                dragStartIndex = parseInt(this.dataset.index);
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleParseDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleParseDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleParseDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndIndex = parseInt(this.dataset.index);
                if (dragStartIndex !== dragEndIndex) {
                    // ä»åŸä½ç½®ç§»é™¤æ‹–åŠ¨çš„é¡¹ç›®
                    const [movedItem] = config.parses.splice(dragStartIndex, 1);
                    
                    // æ’å…¥åˆ°æ–°ä½ç½®
                    config.parses.splice(dragEndIndex, 0, movedItem);
                    
                    loadParses();
                    updateConfigJson();
                }
            }
            
            function handleParseDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            function getTypeName(type) {
                const types = {
                    0: 'xml',
                    1: 'json',
                    2: 'çˆ¬è™«æº',
                    3: 'è‡ªå®šä¹‰çˆ¬è™«',
                    4: 'æœåŠ¡å™¨çˆ¬è™«'
                };
                return types[type] || 'æœªçŸ¥';
            }
            
            function getParseTypeName(type) {
                const types = {
                    0: 'æ™®é€š',
                    1: 'json',
                    2: 'å¤šjson',
                    3: 'èšåˆ'
                };
                return types[type] || 'æœªçŸ¥';
            }

            // ä¿®å¤åçš„æ›´æ–°é…ç½®JSONæ˜¾ç¤ºå‡½æ•° - ä¿®æ”¹extå­—æ®µå¤„ç†
            function updateConfigJson() {
                const globalSpider = globalSpiderInput.value.trim();
                if (globalSpider) {
                    config.spider = globalSpider;
                } else {
                    config.spider = "";
                }
                
                config.flags = vipFlagsInput.value.split(',').map(f => f.trim()).filter(f => f);
                
                // æ›´æ–°IJKé…ç½®æ—¶ä¸å†å¤„ç†æ–‡æœ¬åŒºåŸŸï¼Œå› ä¸ºç°åœ¨ç›´æ¥æ“ä½œconfigå¯¹è±¡
                
                config.ads = adDomainsTextarea.value.split('\n').map(d => d.trim()).filter(d => d);
                
                const wallpaper = wallpaperUrlInput.value.trim();
                if (wallpaper) {
                    config.wallpaper = wallpaper;
                } else {
                    config.wallpaper = "";
                }
                
                // ä¿®å¤extå­—æ®µè½¬ä¹‰é—®é¢˜ - æ‰‹åŠ¨æ„å»ºJSONå­—ç¬¦ä¸²
                let jsonString = '{\n';
                
                // æ·»åŠ spiderå­—æ®µ
                if (config.spider) {
                    jsonString += `  "spider": "${config.spider}",\n`;
                } else {
                    jsonString += `  "spider": "",\n`;
                }
                
                // æ·»åŠ sitesæ•°ç»„
                jsonString += '  "sites": [\n';
                config.sites.forEach((site, index) => {
                    jsonString += '    {\n';
                    jsonString += `      "key": "${site.key}",\n`;
                    jsonString += `      "name": "${site.name}",\n`;
                    jsonString += `      "type": ${site.type},\n`;
                    jsonString += `      "api": "${site.api}",\n`;
                    jsonString += `      "searchable": ${site.searchable},\n`;
                    jsonString += `      "quickSearch": ${site.quickSearch},\n`;
                    jsonString += `      "filterable": ${site.filterable}`;
                    
                    // æ·»åŠ jarå­—æ®µï¼ˆå¦‚æœæœ‰ï¼‰
                    if (site.jar) {
                        jsonString += `,\n      "jar": "${site.jar}"`;
                    }
                    
                    // ä¿®æ”¹ï¼šextå­—æ®µè‡ªåŠ¨æ·»åŠ åŒå¼•å·
                    if (site.ext) {
                        // æ£€æŸ¥extæ˜¯å¦å·²ç»æ˜¯JSONå¯¹è±¡æ ¼å¼ï¼Œå¦‚æœä¸æ˜¯åˆ™æ·»åŠ åŒå¼•å·
                        let extValue = site.ext;
                        if (!extValue.startsWith('{') && !extValue.startsWith('[')) {
                            extValue = `"${extValue}"`;
                        }
                        jsonString += `,\n      "ext": ${extValue}`;
                    }
                    
                    // æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
                    for (const key in site) {
                        if (!['key', 'name', 'type', 'api', 'jar', 'searchable', 'quickSearch', 'filterable', 'ext', 'categories'].includes(key)) {
                            const value = site[key];
                            if (typeof value === 'string') {
                                jsonString += `,\n      "${key}": "${value}"`;
                            } else {
                                // æ•°å­—æˆ–å¸ƒå°”å€¼ï¼Œä¸åŠ å¼•å·
                                jsonString += `,\n      "${key}": ${value}`;
                            }
                        }
                    }
                    
                    // ä¿®æ”¹ï¼šåªæœ‰å½“ç«™ç‚¹æœ‰åˆ†ç±»é…ç½®æ—¶æ‰æ·»åŠ categorieså­—æ®µ
                    if (site.categories && site.categories.length > 0) {
                        jsonString += `,\n      "categories": [\n`;
                        jsonString += site.categories.map(cat => `        "${cat}"`).join(',\n');
                        jsonString += '\n      ]';
                    }
                    
                    jsonString += '\n    }';
                    if (index < config.sites.length - 1) {
                        jsonString += ',';
                    }
                    jsonString += '\n';
                });
                jsonString += '  ],\n';
                
                // æ·»åŠ å…¶ä»–å­—æ®µ...
                jsonString += '  "lives": ' + JSON.stringify(config.lives, null, 2).replace(/\n/g, '\n  ') + ',\n';
                jsonString += '  "parses": ' + JSON.stringify(config.parses, null, 2).replace(/\n/g, '\n  ') + ',\n';
                jsonString += '  "flags": ' + JSON.stringify(config.flags, null, 2).replace(/\n/g, '\n  ') + ',\n';
                jsonString += '  "categories": ' + JSON.stringify(config.categories, null, 2).replace(/\n/g, '\n  ') + ',\n';
                jsonString += '  "ijk": ' + JSON.stringify(config.ijk, null, 2).replace(/\n/g, '\n  ') + ',\n';
                jsonString += '  "ads": ' + JSON.stringify(config.ads, null, 2).replace(/\n/g, '\n  ') + ',\n';
                jsonString += `  "wallpaper": "${config.wallpaper}"\n`;
                
                jsonString += '}';
                
                configJson.value = jsonString;
            }
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            copyBtn.addEventListener('click', async function() {
                if (!configJson.value) {
                    alert("é”™è¯¯ï¼šæ²¡æœ‰å¯å¤åˆ¶çš„é…ç½®å†…å®¹ï¼");
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(configJson.value);
                    alert('âœ… é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                } catch (err) {
                    console.error("å¤åˆ¶å¤±è´¥:", err);
                    configJson.select();
                    try {
                        const success = document.execCommand('copy');
                        alert(success ? 'âœ… é…ç½®å·²å¤åˆ¶ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰ï¼' : 'âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶');
                    } catch (e) {
                        alert('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶');
                    }
                }
            });

            // è¾“å…¥æ¡†å®æ—¶æ›´æ–°é…ç½®
            globalSpiderInput.addEventListener('input', updateConfigJson);
            parseUrlInput.addEventListener('input', updateConfigJson);
            parseExtInput.addEventListener('input', updateConfigJson);
            wallpaperUrlInput.addEventListener('input', updateConfigJson);
            liveGroupInput.addEventListener('input', updateConfigJson);
            liveChannelNameInput.addEventListener('input', updateConfigJson);
            vipFlagsInput.addEventListener('input', updateConfigJson);
            ijkGroupSelect.addEventListener('change', function() {
                updateIjkOptionsTextarea();
                loadIjkOptions();
                updateConfigJson();
            });
            adDomainsTextarea.addEventListener('input', updateConfigJson);
            vodJarInput.addEventListener('input', updateConfigJson);

            // åˆå§‹åŒ–è¡¨å•å€¼
            function initFormValues() {
                if (config.spider) {
                    globalSpiderInput.value = config.spider;
                }
                
                // è®¾ç½®VIPæ ‡è¯†é»˜è®¤å€¼
                vipFlagsInput.value = config.flags.join(',');
                
                // åˆå§‹åŒ–IJKé…ç½®æ˜¾ç¤º
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // è®¾ç½®å¹¿å‘Šè¿‡æ»¤é»˜è®¤å€¼
                adDomainsTextarea.value = config.ads.join('\n');
                
                // åŠ è½½åˆ†ç±»
                loadCategories();
                
                // åŠ è½½åˆ—è¡¨
                loadVodItems();
                loadLiveChannels();
                loadParses();
                
                // åˆå§‹åŒ–URLåˆ é™¤äº‹ä»¶
                document.querySelectorAll('.remove-url').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.parentElement.remove();
                    });
                });
                
                // æ–°å¢ï¼šåˆå§‹åŒ–ç‚¹æ’­æºå¯¼èˆªæ 
                updateVodNavigation();
            }

            // åˆå§‹åŒ–é¡µé¢
            initFormValues();
            updateConfigJson();
        });
    </script>
</body>
</html>